{"key":"using-bundlewatch-instead-of-bundlesize","url":"https://zexo.dev/posts/2020/04/04/using-bundlewatch-instead-of-bundlesize","path":"/posts/2020/04/04/using-bundlewatch-instead-of-bundlesize","title":"Using bundlewatch instead of bundlesize - zexo.dev","breadcrumbs":{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://zexo.dev","name":"Home","position":1},{"@type":"ListItem","item":"https://zexo.dev/posts","name":"Posts","position":2},{"@type":"ListItem","item":"https://zexo.dev/posts/2020/04/04/using-bundlewatch-instead-of-bundlesize","name":"Using bundlewatch instead of bundlesize","position":3}]},"type":"DETAIL","metas":[{"name":"google-site-verification","content":"s3PYm0fCo0ImPqqXoPLiUb_bFdlYODKw54VGSkcFgyE"},{"id":"google-analytics","name":"google-analytics","content":"UA-68904127-2"},{"name":"og:site_name","content":"zexo.dev"},{"name":"og:type","content":"website"},{"name":"og:title","itemprop":"name","content":"Using bundlewatch instead of bundlesize"},{"name":"og:description","itemprop":"description","content":"在 github 上托管的开源项目，特别是对构建产物有体积要求的项目，经常会用到一个叫 bundlesize 的集成服务。https://github.com/siddharthkp/bundlesize\n"},{"name":"og:image","itemprop":"image","content":"https:/zexo.dev/posts/2020/04/04/using-bundlewatch-instead-of-bundlesize/bundlewatch-graph.png"},{"name":"og:type","content":"article"},{"name":"description","itemprop":"description","content":"在 github 上托管的开源项目，特别是对构建产物有体积要求的项目，经常会用到一个叫 bundlesize 的集成服务。https://github.com/siddharthkp/bundlesize\n"}],"data":{"title":"Using bundlewatch instead of bundlesize","id":"using-bundlewatch-instead-of-bundlesize","created":"2020-04-04T00:00:00.000Z","updated":"2020-04-04T00:00:00.000Z","categories":[{"id":"blog","label":"Blog","total":0,"link":"/categories/blog"}],"tags":[{"id":"ci","label":"CI","total":0,"link":"/tags/ci"},{"id":"webpack","label":"Webpack","total":1,"link":"/tags/webpack"},{"id":"github","label":"Github","total":2,"link":"/tags/github"}],"cover":"/posts/2020/04/04/using-bundlewatch-instead-of-bundlesize/bundlewatch-graph.png","images":["./ci-commit-status.png","./bundlewatch-graph.png"],"toc":[{"label":"Using bundlewatch instead of bundlesize","level":1,"id":"using-bundlewatch-instead-of-bundlesize","position":0,"children":[],"pid":-1},{"label":"背景","level":2,"id":"背景","position":1,"children":[],"pid":0},{"label":"迁移过程","level":2,"id":"迁移过程","position":2,"children":[],"pid":0},{"label":"迁移前: bundlesize 配置","level":3,"id":"迁移前-bundlesize-配置","position":3,"children":[],"pid":2},{"label":"迁移后:","level":3,"id":"迁移后","position":4,"children":[],"pid":2},{"label":"效果","level":2,"id":"效果","position":5,"children":[],"pid":0},{"label":"CI Checking on Commit Status","level":3,"id":"ci-checking-on-commit-status","position":6,"children":[],"pid":5},{"label":"构建产物体积曲线图","level":3,"id":"构建产物体积曲线图","position":7,"children":[],"pid":5},{"label":"References","level":2,"id":"references","position":8,"children":[],"pid":0}],"summary":"在 github 上托管的开源项目，特别是对构建产物有体积要求的项目，经常会用到一个叫 bundlesize 的集成服务。https://github.com/siddharthkp/bundlesize\n","src":"\n# Using bundlewatch instead of bundlesize\n\n## 背景\n\n在 github 上托管的开源项目，特别是对构建产物有体积要求的项目，经常会用到一个叫 bundlesize 的集成服务。\n\n[https://github.com/siddharthkp/bundlesize](https://github.com/siddharthkp/bundlesize)\n\n我是从 [https://developers.google.com/web/fundamentals/performance/webpack/](https://developers.google.com/web/fundamentals/performance/webpack/) 中了解到 bundlesize 这个服务的。\n\n由于 bundlesize 项目日久失修，没人维护。以至于我之前接入了 bundlesize 并以此作为 CI Checking 的项目收到了其影响，具体表现为上传数据长时间无响应，影响了整个 CI 构建通知的时间序列。\n\n为此，Github 上自发地来了个新的项目，来代替 bundlesize。\n\n那就是今天要介绍的 bundlewatch。\n\n在其官方文档中，描述了为什么要从 bundlesize 迁移到 bundlewatch (加粗部分是我选择的目的)\n\n- **bundlesize 已经不再维护，各种 issue 没人管**\n- **提供了 [bundlewatch.io](http://bundlewatch.io) 作为官方文档网站(原本这些)**\n- 提供了了足够的测试覆盖率\n- 有 Node API 支持 (可以程序化调用 bundlewatch)\n- 提供了在线的 bundlewatch 配置校验\n- 更好看的数据展示页面\n- **支持自主部署 bundlewatch hosting 服务(也就是为企业内部服务提供了可能)**\n\n本片文章内容上比较朴素，属于科普向，主要内容如下:\n\n- 迁移之前: 我的 bundlesize 配置\n- 迁移之后: 我的 bundlewatch 配置\n- bundlewatch 监控效果图\n\n## 迁移过程\n\n### 迁移前: bundlesize 配置\n\n在使用 bundlesize 的时候，我们需要做以下几项工作，来达到计算构建产物体积 → 设定产物体积增减红线 → 通过更新 CI Status 反馈本次 commit 质量的目的。\n\n为此，你大概需要在你的项目上做到:\n\n- 添加 bundlesize 作为集成服务 (在 Github 网页上操作)\n- 安装 bundlesize 作为依赖\n- 添加 bundlesize 配置\n- 将 bundlesize 加入 CI 构建步骤 (使 bundlesize 能够通过获你的 Github Token 进行 CI Status 的反馈)\n\n**安装 bundlesize 作为依赖**\n\n```bash\nyarn add -D bundlesize\n```\n\n**添加 bundlesize 配置 (in `package.json` )**\n\n相对于项目根目录的构建产物，使用 glob pattern 进行文件匹配，bundlesize 将会计算每个分组下的文件大小总和，并新增一个 npm script: `bundlesize: bundlesize` 用于执行 bundlesize 计算\n\n```json\n{\n  \"bundlesize\": [\n    {\n      \"path\": \"./dist/static/js/*.js\",\n      \"maxSize\": \"400 kB\"\n    },\n    {\n      \"path\": \"./dist/static/css/*.css\",\n      \"maxSize\": \"30 kB\"\n    }\n  ]\n}\n```\n\n**将 bundlesize 加入 CI 步骤**\n\n此步需要一个有权限提交 Commit Status 的 Github Token，假设已经放在 Github Repository 的 Secrets 添加此 Token，并命名为 `BUNDLESIZE_GITHUB_TOKEN`\n\n在 Github Actions 的 workflow 下添加一步\n\n```yaml\n- name: Check bundlesize\n  run: |\n    yarn build:prod\n    yarn bundlesize\n  env:\n    BUNDLESIZE_GITHUB_TOKEN: ${{ secrets.BUNDLESIZE_GITHUB_TOKEN }}\n```\n\n### 迁移后:\n\n整体迁移步骤也挺简单，基于已经有 `bundlesize` 相关配置的话，代码层面只需要改上面的两步：\n\n- 添加 bundlewatch 作为集成服务 (在 Github 网页上操作)\n- 将 bundlesize 依赖、配置修改为 bundlewatch\n- 将 bundlesize CI 配置修改为 bundlewatch\n\n**bundlesize 依赖、配置修改为 bundlewatch**\n\n```bash\nyarn add -D bundlewatch\nyarn remove bundlesize\n```\n\n上面 npm script 也应当同步修改为 `bundlewatch: bundlewatch`\n\n```json\n{\n  \"bundlewatch\": {\n    \"files\": [\n      {\n        \"path\": \"dist/static/js/*.js\",\n        \"maxSize\": \"400 kB\"\n      },\n      {\n        \"path\": \"dist/static/css/*.css\",\n        \"maxSize\": \"30 kB\"\n      }\n    ]\n  }\n}\n```\n\n**将 bundlesize CI 配置修改为 bundlewatch**\n\n```yaml\n- name: Check bundlewatch\n  run: |\n    yarn build:prod\n    yarn bundlewatch\n  env:\n    BUNDLEWATCH_GITHUB_TOKEN: ${{ secrets.BUNDLESIZE_GITHUB_TOKEN }}\n```\n\n## 效果\n\n### CI Checking on Commit Status\n\n![ci-commit-status](./ci-commit-status.png)\n\n### 构建产物体积曲线图\n\n![bundlewatch-graph](./bundlewatch-graph.png)\n\n## References\n\n[https://github.com/bundlewatch/bundlewatch](https://github.com/bundlewatch/bundlewatch)\n","html":"<h1 id=\"using-bundlewatch-instead-of-bundlesize\">Using bundlewatch instead of bundlesize</h1>\n<h2 id=\"背景\">背景</h2>\n<p>在 github 上托管的开源项目，特别是对构建产物有体积要求的项目，经常会用到一个叫 bundlesize 的集成服务。</p>\n<p><a href=\"https://github.com/siddharthkp/bundlesize\">https://github.com/siddharthkp/bundlesize</a></p>\n<p>我是从 <a href=\"https://developers.google.com/web/fundamentals/performance/webpack/\">https://developers.google.com/web/fundamentals/performance/webpack/</a> 中了解到 bundlesize 这个服务的。</p>\n<p>由于 bundlesize 项目日久失修，没人维护。以至于我之前接入了 bundlesize 并以此作为 CI Checking 的项目收到了其影响，具体表现为上传数据长时间无响应，影响了整个 CI 构建通知的时间序列。</p>\n<p>为此，Github 上自发地来了个新的项目，来代替 bundlesize。</p>\n<p>那就是今天要介绍的 bundlewatch。</p>\n<p>在其官方文档中，描述了为什么要从 bundlesize 迁移到 bundlewatch (加粗部分是我选择的目的)</p>\n<ul>\n<li><strong>bundlesize 已经不再维护，各种 issue 没人管</strong></li>\n<li><strong>提供了 <a href=\"http://bundlewatch.io\">bundlewatch.io</a> 作为官方文档网站(原本这些)</strong></li>\n<li>提供了了足够的测试覆盖率</li>\n<li>有 Node API 支持 (可以程序化调用 bundlewatch)</li>\n<li>提供了在线的 bundlewatch 配置校验</li>\n<li>更好看的数据展示页面</li>\n<li><strong>支持自主部署 bundlewatch hosting 服务(也就是为企业内部服务提供了可能)</strong></li>\n</ul>\n<p>本片文章内容上比较朴素，属于科普向，主要内容如下:</p>\n<ul>\n<li>迁移之前: 我的 bundlesize 配置</li>\n<li>迁移之后: 我的 bundlewatch 配置</li>\n<li>bundlewatch 监控效果图</li>\n</ul>\n<h2 id=\"迁移过程\">迁移过程</h2>\n<h3 id=\"迁移前-bundlesize-配置\">迁移前: bundlesize 配置</h3>\n<p>在使用 bundlesize 的时候，我们需要做以下几项工作，来达到计算构建产物体积 → 设定产物体积增减红线 → 通过更新 CI Status 反馈本次 commit 质量的目的。</p>\n<p>为此，你大概需要在你的项目上做到:</p>\n<ul>\n<li>添加 bundlesize 作为集成服务 (在 Github 网页上操作)</li>\n<li>安装 bundlesize 作为依赖</li>\n<li>添加 bundlesize 配置</li>\n<li>将 bundlesize 加入 CI 构建步骤 (使 bundlesize 能够通过获你的 Github Token 进行 CI Status 的反馈)</li>\n</ul>\n<p><strong>安装 bundlesize 作为依赖</strong></p>\n<pre class=\"hljs\"><code>yarn add -D bundlesize\n</code></pre>\n<p><strong>添加 bundlesize 配置 (in <code>package.json</code> )</strong></p>\n<p>相对于项目根目录的构建产物，使用 glob pattern 进行文件匹配，bundlesize 将会计算每个分组下的文件大小总和，并新增一个 npm script: <code>bundlesize: bundlesize</code> 用于执行 bundlesize 计算</p>\n<pre class=\"hljs\"><code>{\n  <span class=\"hljs-attr\">\"bundlesize\"</span>: [\n    {\n      <span class=\"hljs-attr\">\"path\"</span>: <span class=\"hljs-string\">\"./dist/static/js/*.js\"</span>,\n      <span class=\"hljs-attr\">\"maxSize\"</span>: <span class=\"hljs-string\">\"400 kB\"</span>\n    },\n    {\n      <span class=\"hljs-attr\">\"path\"</span>: <span class=\"hljs-string\">\"./dist/static/css/*.css\"</span>,\n      <span class=\"hljs-attr\">\"maxSize\"</span>: <span class=\"hljs-string\">\"30 kB\"</span>\n    }\n  ]\n}\n</code></pre>\n<p><strong>将 bundlesize 加入 CI 步骤</strong></p>\n<p>此步需要一个有权限提交 Commit Status 的 Github Token，假设已经放在 Github Repository 的 Secrets 添加此 Token，并命名为 <code>BUNDLESIZE_GITHUB_TOKEN</code></p>\n<p>在 Github Actions 的 workflow 下添加一步</p>\n<pre class=\"hljs\"><code><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Check</span> <span class=\"hljs-string\">bundlesize</span>\n  <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n    yarn build:prod\n    yarn bundlesize\n</span>  <span class=\"hljs-attr\">env:</span>\n    <span class=\"hljs-attr\">BUNDLESIZE_GITHUB_TOKEN:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.BUNDLESIZE_GITHUB_TOKEN</span> <span class=\"hljs-string\">}}</span>\n</code></pre>\n<h3 id=\"迁移后\">迁移后:</h3>\n<p>整体迁移步骤也挺简单，基于已经有 <code>bundlesize</code> 相关配置的话，代码层面只需要改上面的两步：</p>\n<ul>\n<li>添加 bundlewatch 作为集成服务 (在 Github 网页上操作)</li>\n<li>将 bundlesize 依赖、配置修改为 bundlewatch</li>\n<li>将 bundlesize CI 配置修改为 bundlewatch</li>\n</ul>\n<p><strong>bundlesize 依赖、配置修改为 bundlewatch</strong></p>\n<pre class=\"hljs\"><code>yarn add -D bundlewatch\nyarn remove bundlesize\n</code></pre>\n<p>上面 npm script 也应当同步修改为 <code>bundlewatch: bundlewatch</code></p>\n<pre class=\"hljs\"><code>{\n  <span class=\"hljs-attr\">\"bundlewatch\"</span>: {\n    <span class=\"hljs-attr\">\"files\"</span>: [\n      {\n        <span class=\"hljs-attr\">\"path\"</span>: <span class=\"hljs-string\">\"dist/static/js/*.js\"</span>,\n        <span class=\"hljs-attr\">\"maxSize\"</span>: <span class=\"hljs-string\">\"400 kB\"</span>\n      },\n      {\n        <span class=\"hljs-attr\">\"path\"</span>: <span class=\"hljs-string\">\"dist/static/css/*.css\"</span>,\n        <span class=\"hljs-attr\">\"maxSize\"</span>: <span class=\"hljs-string\">\"30 kB\"</span>\n      }\n    ]\n  }\n}\n</code></pre>\n<p><strong>将 bundlesize CI 配置修改为 bundlewatch</strong></p>\n<pre class=\"hljs\"><code><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Check</span> <span class=\"hljs-string\">bundlewatch</span>\n  <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n    yarn build:prod\n    yarn bundlewatch\n</span>  <span class=\"hljs-attr\">env:</span>\n    <span class=\"hljs-attr\">BUNDLEWATCH_GITHUB_TOKEN:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.BUNDLESIZE_GITHUB_TOKEN</span> <span class=\"hljs-string\">}}</span>\n</code></pre>\n<h2 id=\"效果\">效果</h2>\n<h3 id=\"ci-checking-on-commit-status\">CI Checking on Commit Status</h3>\n<p>\n        <picture>\n          <source srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABkAAAAJWAQMAAAA6AtlxAAAAA1BMVEX///+nxBvIAAAAi0lEQVR42u3BAQ0AAADCoPdPbQ8HFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wbVlQABttAC+QAAAABJRU5ErkJggg==\"  data-srcset=\"/posts/2020/04/04/using-bundlewatch-instead-of-bundlesize/ci-commit-status.webp\" type=\"image/webp\" data-was-processed=\"false\" />\n          <img alt=\"\" class=\"lazy\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABkAAAAJWAQMAAAA6AtlxAAAAA1BMVEX///+nxBvIAAAAi0lEQVR42u3BAQ0AAADCoPdPbQ8HFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wbVlQABttAC+QAAAABJRU5ErkJggg==\" data-src=\"/posts/2020/04/04/using-bundlewatch-instead-of-bundlesize/ci-commit-status.png\" loading=\"lazy\"/>\n        </picture>\n    </p>\n<h3 id=\"构建产物体积曲线图\">构建产物体积曲线图</h3>\n<p>\n        <picture>\n          <source srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABkAAAAJWAQMAAAA6AtlxAAAAA1BMVEX///+nxBvIAAAAi0lEQVR42u3BAQ0AAADCoPdPbQ8HFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wbVlQABttAC+QAAAABJRU5ErkJggg==\"  data-srcset=\"/posts/2020/04/04/using-bundlewatch-instead-of-bundlesize/bundlewatch-graph.webp\" type=\"image/webp\" data-was-processed=\"false\" />\n          <img alt=\"\" class=\"lazy\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABkAAAAJWAQMAAAA6AtlxAAAAA1BMVEX///+nxBvIAAAAi0lEQVR42u3BAQ0AAADCoPdPbQ8HFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wbVlQABttAC+QAAAABJRU5ErkJggg==\" data-src=\"/posts/2020/04/04/using-bundlewatch-instead-of-bundlesize/bundlewatch-graph.png\" loading=\"lazy\"/>\n        </picture>\n    </p>\n<h2 id=\"references\">References</h2>\n<p><a href=\"https://github.com/bundlewatch/bundlewatch\">https://github.com/bundlewatch/bundlewatch</a></p>\n","disqus":{"shortname":"aquariuslt","url":"https://zexo.dev/posts/2020/04/04/using-bundlewatch-instead-of-bundlesize","identifier":"-posts-2020-04-04-using-bundlewatch-instead-of-bundlesize"}}}