<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><title>Spring 整合 Apache Shiro 实现各等级的权限管理 - zexo.dev</title><meta name="viewport" content="minimum-scale=1,initial-scale=1,width=device-width,shrink-to-fit=no"><script async="" src="https://www.google-analytics.com/analytics.js"></script><link rel="icon" href="/favicon.png"><link rel="shortcut icon" href="/static/img/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/static/img/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/static/img/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/static/img/favicon-48x48.png"><link rel="manifest" href="/static/img/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" content="#FFFFFF"><meta name="application-name" content="zexo.dev"><link rel="apple-touch-icon" sizes="57x57" href="/static/img/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/static/img/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/static/img/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/static/img/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/static/img/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/static/img/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/static/img/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/static/img/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/static/img/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/static/img/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="1024x1024" href="/static/img/apple-touch-icon-1024x1024.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="zexo.dev"><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/img/apple-touch-startup-image-640x1136.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/img/apple-touch-startup-image-750x1334.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/img/apple-touch-startup-image-828x1792.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/static/img/apple-touch-startup-image-1125x2436.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/static/img/apple-touch-startup-image-1242x2208.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/static/img/apple-touch-startup-image-1242x2688.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/img/apple-touch-startup-image-1536x2048.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/img/apple-touch-startup-image-1668x2224.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/img/apple-touch-startup-image-1668x2388.png"><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/img/apple-touch-startup-image-2048x2732.png"><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/static/img/apple-touch-startup-image-1620x2160.png"><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/img/apple-touch-startup-image-1136x640.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/img/apple-touch-startup-image-1334x750.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/img/apple-touch-startup-image-1792x828.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/static/img/apple-touch-startup-image-2436x1125.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/static/img/apple-touch-startup-image-2208x1242.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/static/img/apple-touch-startup-image-2688x1242.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/img/apple-touch-startup-image-2048x1536.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/img/apple-touch-startup-image-2224x1668.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/img/apple-touch-startup-image-2388x1668.png"><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/img/apple-touch-startup-image-2732x2048.png"><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/static/img/apple-touch-startup-image-2160x1620.png"><link rel="icon" type="image/png" sizes="228x228" href="/static/img/coast-228x228.png"><meta name="msapplication-TileColor" content="#FFFFFF"><meta name="msapplication-TileImage" content="/static/img/mstile-144x144.png"><meta name="msapplication-config" content="/static/img/browserconfig.xml"><link rel="yandex-tableau-widget" href="/static/img/yandex-browser-manifest.json"><link href="/static/css/vendors.b080bef2d65920182a2a.css" rel="stylesheet"><link href="/static/css/main.2e4a0776f36cd619f3c7.css" rel="stylesheet"><link as="style" href="/static/css/detail.ef17f79594051c627ba9.css" rel="preload"><link as="style" href="/static/css/main.2e4a0776f36cd619f3c7.css" rel="preload"><link as="style" href="/static/css/vendors.b080bef2d65920182a2a.css" rel="preload"><link as="script" href="/static/js/detail.ef17f79594051c627ba9.js" rel="preload"><link as="script" href="/static/js/main.2e4a0776f36cd619f3c7.js" rel="preload"><link as="script" href="/static/js/vendors.b080bef2d65920182a2a.js" rel="preload"><style data-jss="" data-meta="MuiPaper">
.MuiPaper-root {
  color: rgba(0, 0, 0, 0.87);
  transition: box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
  background-color: #FFFFFF;
}
.MuiPaper-rounded {
  border-radius: 4px;
}
.MuiPaper-outlined {
  border: 1px solid rgba(0, 0, 0, 0.12);
}
.MuiPaper-elevation0 {
  box-shadow: none;
}
.MuiPaper-elevation1 {
  box-shadow: 0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);
}
.MuiPaper-elevation2 {
  box-shadow: 0px 3px 1px -2px rgba(0,0,0,0.2),0px 2px 2px 0px rgba(0,0,0,0.14),0px 1px 5px 0px rgba(0,0,0,0.12);
}
.MuiPaper-elevation3 {
  box-shadow: 0px 3px 3px -2px rgba(0,0,0,0.2),0px 3px 4px 0px rgba(0,0,0,0.14),0px 1px 8px 0px rgba(0,0,0,0.12);
}
.MuiPaper-elevation4 {
  box-shadow: 0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12);
}
.MuiPaper-elevation5 {
  box-shadow: 0px 3px 5px -1px rgba(0,0,0,0.2),0px 5px 8px 0px rgba(0,0,0,0.14),0px 1px 14px 0px rgba(0,0,0,0.12);
}
.MuiPaper-elevation6 {
  box-shadow: 0px 3px 5px -1px rgba(0,0,0,0.2),0px 6px 10px 0px rgba(0,0,0,0.14),0px 1px 18px 0px rgba(0,0,0,0.12);
}
.MuiPaper-elevation7 {
  box-shadow: 0px 4px 5px -2px rgba(0,0,0,0.2),0px 7px 10px 1px rgba(0,0,0,0.14),0px 2px 16px 1px rgba(0,0,0,0.12);
}
.MuiPaper-elevation8 {
  box-shadow: 0px 5px 5px -3px rgba(0,0,0,0.2),0px 8px 10px 1px rgba(0,0,0,0.14),0px 3px 14px 2px rgba(0,0,0,0.12);
}
.MuiPaper-elevation9 {
  box-shadow: 0px 5px 6px -3px rgba(0,0,0,0.2),0px 9px 12px 1px rgba(0,0,0,0.14),0px 3px 16px 2px rgba(0,0,0,0.12);
}
.MuiPaper-elevation10 {
  box-shadow: 0px 6px 6px -3px rgba(0,0,0,0.2),0px 10px 14px 1px rgba(0,0,0,0.14),0px 4px 18px 3px rgba(0,0,0,0.12);
}
.MuiPaper-elevation11 {
  box-shadow: 0px 6px 7px -4px rgba(0,0,0,0.2),0px 11px 15px 1px rgba(0,0,0,0.14),0px 4px 20px 3px rgba(0,0,0,0.12);
}
.MuiPaper-elevation12 {
  box-shadow: 0px 7px 8px -4px rgba(0,0,0,0.2),0px 12px 17px 2px rgba(0,0,0,0.14),0px 5px 22px 4px rgba(0,0,0,0.12);
}
.MuiPaper-elevation13 {
  box-shadow: 0px 7px 8px -4px rgba(0,0,0,0.2),0px 13px 19px 2px rgba(0,0,0,0.14),0px 5px 24px 4px rgba(0,0,0,0.12);
}
.MuiPaper-elevation14 {
  box-shadow: 0px 7px 9px -4px rgba(0,0,0,0.2),0px 14px 21px 2px rgba(0,0,0,0.14),0px 5px 26px 4px rgba(0,0,0,0.12);
}
.MuiPaper-elevation15 {
  box-shadow: 0px 8px 9px -5px rgba(0,0,0,0.2),0px 15px 22px 2px rgba(0,0,0,0.14),0px 6px 28px 5px rgba(0,0,0,0.12);
}
.MuiPaper-elevation16 {
  box-shadow: 0px 8px 10px -5px rgba(0,0,0,0.2),0px 16px 24px 2px rgba(0,0,0,0.14),0px 6px 30px 5px rgba(0,0,0,0.12);
}
.MuiPaper-elevation17 {
  box-shadow: 0px 8px 11px -5px rgba(0,0,0,0.2),0px 17px 26px 2px rgba(0,0,0,0.14),0px 6px 32px 5px rgba(0,0,0,0.12);
}
.MuiPaper-elevation18 {
  box-shadow: 0px 9px 11px -5px rgba(0,0,0,0.2),0px 18px 28px 2px rgba(0,0,0,0.14),0px 7px 34px 6px rgba(0,0,0,0.12);
}
.MuiPaper-elevation19 {
  box-shadow: 0px 9px 12px -6px rgba(0,0,0,0.2),0px 19px 29px 2px rgba(0,0,0,0.14),0px 7px 36px 6px rgba(0,0,0,0.12);
}
.MuiPaper-elevation20 {
  box-shadow: 0px 10px 13px -6px rgba(0,0,0,0.2),0px 20px 31px 3px rgba(0,0,0,0.14),0px 8px 38px 7px rgba(0,0,0,0.12);
}
.MuiPaper-elevation21 {
  box-shadow: 0px 10px 13px -6px rgba(0,0,0,0.2),0px 21px 33px 3px rgba(0,0,0,0.14),0px 8px 40px 7px rgba(0,0,0,0.12);
}
.MuiPaper-elevation22 {
  box-shadow: 0px 10px 14px -6px rgba(0,0,0,0.2),0px 22px 35px 3px rgba(0,0,0,0.14),0px 8px 42px 7px rgba(0,0,0,0.12);
}
.MuiPaper-elevation23 {
  box-shadow: 0px 11px 14px -7px rgba(0,0,0,0.2),0px 23px 36px 3px rgba(0,0,0,0.14),0px 9px 44px 8px rgba(0,0,0,0.12);
}
.MuiPaper-elevation24 {
  box-shadow: 0px 11px 15px -7px rgba(0,0,0,0.2),0px 24px 38px 3px rgba(0,0,0,0.14),0px 9px 46px 8px rgba(0,0,0,0.12);
}
</style><style data-jss="" data-meta="MuiTouchRipple">
.MuiTouchRipple-root {
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 0;
  overflow: hidden;
  position: absolute;
  border-radius: inherit;
  pointer-events: none;
}
.MuiTouchRipple-ripple {
  opacity: 0;
  position: absolute;
}
.MuiTouchRipple-rippleVisible {
  opacity: 0.3;
  animation: MuiTouchRipple-keyframes-enter 550ms cubic-bezier(0.4, 0, 0.2, 1);
  transform: scale(1);
}
.MuiTouchRipple-ripplePulsate {
  animation-duration: 200ms;
}
.MuiTouchRipple-child {
  width: 100%;
  height: 100%;
  display: block;
  opacity: 1;
  border-radius: 50%;
  background-color: currentColor;
}
.MuiTouchRipple-childLeaving {
  opacity: 0;
  animation: MuiTouchRipple-keyframes-exit 550ms cubic-bezier(0.4, 0, 0.2, 1);
}
.MuiTouchRipple-childPulsate {
  top: 0;
  left: 0;
  position: absolute;
  animation: MuiTouchRipple-keyframes-pulsate 2500ms cubic-bezier(0.4, 0, 0.2, 1) 200ms infinite;
}
@-webkit-keyframes MuiTouchRipple-keyframes-enter {
  0% {
    opacity: 0.1;
    transform: scale(0);
  }
  100% {
    opacity: 0.3;
    transform: scale(1);
  }
}
@-webkit-keyframes MuiTouchRipple-keyframes-exit {
  0% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}
@-webkit-keyframes MuiTouchRipple-keyframes-pulsate {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(0.92);
  }
  100% {
    transform: scale(1);
  }
}
</style><style data-jss="" data-meta="MuiButtonBase">
.MuiButtonBase-root {
  color: inherit;
  border: 0;
  cursor: pointer;
  margin: 0;
  display: inline-flex;
  outline: 0;
  padding: 0;
  position: relative;
  align-items: center;
  user-select: none;
  border-radius: 0;
  vertical-align: middle;
  -moz-appearance: none;
  justify-content: center;
  text-decoration: none;
  background-color: transparent;
  -webkit-appearance: none;
  -webkit-tap-highlight-color: transparent;
}
.MuiButtonBase-root::-moz-focus-inner {
  border-style: none;
}
.MuiButtonBase-root.Mui-disabled {
  cursor: default;
  pointer-events: none;
}
@media print {
  .MuiButtonBase-root {
    -webkit-print-color-adjust: exact;
  }
}
</style><style data-jss="" data-meta="MuiTypography">
.MuiTypography-root {
  margin: 0;
  font-family: Roboto, XHei, -apple-system, BlinkMacSystemFont, PingFang SC, Hiragino Sans GB, Microsoft YaHei,
    WenQuanYi Micro Hei, Segoe UI, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;
}
.MuiTypography-body2 {
  font-size: 0.875rem;
  font-family: Roboto, XHei, -apple-system, BlinkMacSystemFont, PingFang SC, Hiragino Sans GB, Microsoft YaHei,
    WenQuanYi Micro Hei, Segoe UI, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;
  font-weight: 400;
  line-height: 1.43;
  letter-spacing: 0.01071em;
}
.MuiTypography-body1 {
  font-size: 1rem;
  font-family: Roboto, XHei, -apple-system, BlinkMacSystemFont, PingFang SC, Hiragino Sans GB, Microsoft YaHei,
    WenQuanYi Micro Hei, Segoe UI, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;
  font-weight: 400;
  line-height: 1.5;
  letter-spacing: 0.00938em;
}
.MuiTypography-caption {
  font-size: 0.75rem;
  font-family: "Roboto", "Helvetica", "Arial", sans-serif;
  font-weight: 400;
  line-height: 1.66;
  letter-spacing: 0.03333em;
}
.MuiTypography-button {
  font-size: 0.875rem;
  font-family: "Roboto", "Helvetica", "Arial", sans-serif;
  font-weight: 500;
  line-height: 1.75;
  letter-spacing: 0.02857em;
  text-transform: uppercase;
}
.MuiTypography-h1 {
  font-size: 6rem;
  font-family: "Roboto", "Helvetica", "Arial", sans-serif;
  font-weight: 300;
  line-height: 1.167;
  letter-spacing: -0.01562em;
}
.MuiTypography-h2 {
  font-size: 3.75rem;
  font-family: "Roboto", "Helvetica", "Arial", sans-serif;
  font-weight: 300;
  line-height: 1.2;
  letter-spacing: -0.00833em;
}
.MuiTypography-h3 {
  font-size: 3rem;
  font-family: "Roboto", "Helvetica", "Arial", sans-serif;
  font-weight: 400;
  line-height: 1.167;
  letter-spacing: 0em;
}
.MuiTypography-h4 {
  font-size: 2.125rem;
  font-family: "Roboto", "Helvetica", "Arial", sans-serif;
  font-weight: 400;
  line-height: 1.235;
  letter-spacing: 0.00735em;
}
.MuiTypography-h5 {
  font-size: 1.5rem;
  font-family: Roboto, XHei, -apple-system, BlinkMacSystemFont, PingFang SC, Hiragino Sans GB, Microsoft YaHei,
    WenQuanYi Micro Hei, Segoe UI, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;
  font-weight: 400;
  line-height: 1.334;
  letter-spacing: 0em;
}
.MuiTypography-h6 {
  font-size: 1.25rem;
  font-family: "Roboto", "Helvetica", "Arial", sans-serif;
  font-weight: 500;
  line-height: 1.6;
  letter-spacing: 0.0075em;
}
.MuiTypography-subtitle1 {
  font-size: 1rem;
  font-family: "Roboto", "Helvetica", "Arial", sans-serif;
  font-weight: 400;
  line-height: 1.75;
  letter-spacing: 0.00938em;
}
.MuiTypography-subtitle2 {
  font-size: 0.875rem;
  font-family: "Roboto", "Helvetica", "Arial", sans-serif;
  font-weight: 500;
  line-height: 1.57;
  letter-spacing: 0.00714em;
}
.MuiTypography-overline {
  font-size: 0.75rem;
  font-family: "Roboto", "Helvetica", "Arial", sans-serif;
  font-weight: 400;
  line-height: 2.66;
  letter-spacing: 0.08333em;
  text-transform: uppercase;
}
.MuiTypography-srOnly {
  width: 1px;
  height: 1px;
  overflow: hidden;
  position: absolute;
}
.MuiTypography-alignLeft {
  text-align: left;
}
.MuiTypography-alignCenter {
  text-align: center;
}
.MuiTypography-alignRight {
  text-align: right;
}
.MuiTypography-alignJustify {
  text-align: justify;
}
.MuiTypography-noWrap {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
.MuiTypography-gutterBottom {
  margin-bottom: 0.35em;
}
.MuiTypography-paragraph {
  margin-bottom: 16px;
}
.MuiTypography-colorInherit {
  color: inherit;
}
.MuiTypography-colorPrimary {
  color: #FFFFFF;
}
.MuiTypography-colorSecondary {
  color: #f50057;
}
.MuiTypography-colorTextPrimary {
  color: rgba(0, 0, 0, 0.87);
}
.MuiTypography-colorTextSecondary {
  color: rgba(0, 0, 0, 0.54);
}
.MuiTypography-colorError {
  color: #f44336;
}
.MuiTypography-displayInline {
  display: inline;
}
.MuiTypography-displayBlock {
  display: block;
}
</style><style data-jss="" data-meta="MuiSvgIcon">
.MuiSvgIcon-root {
  fill: currentColor;
  width: 1em;
  height: 1em;
  display: inline-block;
  font-size: 1.5rem;
  transition: fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
  flex-shrink: 0;
  user-select: none;
}
.MuiSvgIcon-colorPrimary {
  color: #FFFFFF;
}
.MuiSvgIcon-colorSecondary {
  color: #f50057;
}
.MuiSvgIcon-colorAction {
  color: rgba(0, 0, 0, 0.54);
}
.MuiSvgIcon-colorError {
  color: #f44336;
}
.MuiSvgIcon-colorDisabled {
  color: rgba(0, 0, 0, 0.26);
}
.MuiSvgIcon-fontSizeInherit {
  font-size: inherit;
}
.MuiSvgIcon-fontSizeSmall {
  font-size: 1.25rem;
}
.MuiSvgIcon-fontSizeLarge {
  font-size: 2.1875rem;
}
</style><style data-jss="" data-meta="MuiLink">
.MuiLink-underlineNone {
  text-decoration: none;
}
.MuiLink-underlineHover {
  text-decoration: none;
}
.MuiLink-underlineHover:hover {
  text-decoration: underline;
}
.MuiLink-underlineAlways {
  text-decoration: underline;
}
.MuiLink-button {
  border: 0;
  cursor: pointer;
  margin: 0;
  outline: 0;
  padding: 0;
  position: relative;
  user-select: none;
  border-radius: 0;
  vertical-align: middle;
  -moz-appearance: none;
  background-color: transparent;
  -webkit-appearance: none;
  -webkit-tap-highlight-color: transparent;
}
.MuiLink-button::-moz-focus-inner {
  border-style: none;
}
.MuiLink-button.Mui-focusVisible {
  outline: auto;
}
</style><style data-jss="" data-meta="MuiBreadcrumbs">
.MuiBreadcrumbs-ol {
  margin: 0;
  display: flex;
  padding: 0;
  flex-wrap: wrap;
  list-style: none;
  align-items: center;
}
.MuiBreadcrumbs-separator {
  display: flex;
  margin-left: 8px;
  user-select: none;
  margin-right: 8px;
}
</style><style data-jss="" data-meta="makeStyles">
.jss160 {
  width: 100%;
  flex-wrap: wrap;
  max-width: 800px;
  justify-content: center;
}
.jss161 {
  padding: 8px 16px;
  background-color: #FFFFFF;
}
@media (max-width:959.95px) {
  .jss161 {
    padding: 8px;
  }
}
.jss162 > ol {
  flex-wrap: nowrap;
}
.jss162 > ol > li:last-child {
  overflow-y: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
</style><style data-jss="" data-meta="MuiContainer">
.MuiContainer-root {
  width: 100%;
  display: block;
  box-sizing: border-box;
  margin-left: auto;
  margin-right: auto;
  padding-left: 16px;
  padding-right: 16px;
}
@media (min-width:600px) {
  .MuiContainer-root {
    padding-left: 24px;
    padding-right: 24px;
  }
}
.MuiContainer-disableGutters {
  padding-left: 0;
  padding-right: 0;
}
@media (min-width:600px) {
  .MuiContainer-fixed {
    max-width: 600px;
  }
}
@media (min-width:960px) {
  .MuiContainer-fixed {
    max-width: 960px;
  }
}
@media (min-width:1280px) {
  .MuiContainer-fixed {
    max-width: 1280px;
  }
}
@media (min-width:1920px) {
  .MuiContainer-fixed {
    max-width: 1920px;
  }
}
@media (min-width:0px) {
  .MuiContainer-maxWidthXs {
    max-width: 444px;
  }
}
@media (min-width:600px) {
  .MuiContainer-maxWidthSm {
    max-width: 600px;
  }
}
@media (min-width:960px) {
  .MuiContainer-maxWidthMd {
    max-width: 960px;
  }
}
@media (min-width:1280px) {
  .MuiContainer-maxWidthLg {
    max-width: 1280px;
  }
}
@media (min-width:1920px) {
  .MuiContainer-maxWidthXl {
    max-width: 1920px;
  }
}
</style><style data-jss="" data-meta="MuiDivider">
.MuiDivider-root {
  border: none;
  height: 1px;
  margin: 0;
  flex-shrink: 0;
  background-color: rgba(0, 0, 0, 0.12);
}
.MuiDivider-absolute {
  left: 0;
  width: 100%;
  bottom: 0;
  position: absolute;
}
.MuiDivider-inset {
  margin-left: 72px;
}
.MuiDivider-light {
  background-color: rgba(0, 0, 0, 0.08);
}
.MuiDivider-middle {
  margin-left: 16px;
  margin-right: 16px;
}
.MuiDivider-vertical {
  width: 1px;
  height: 100%;
}
.MuiDivider-flexItem {
  height: auto;
  align-self: stretch;
}
</style><style data-jss="" data-meta="MuiCssBaseline">
html {
  box-sizing: border-box;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
*, *::before, *::after {
  box-sizing: inherit;
}
strong, b {
  font-weight: 700;
}
body {
  color: rgba(0, 0, 0, 0.87);
  margin: 0;
  font-size: 0.875rem;
  font-family: "Roboto", "Helvetica", "Arial", sans-serif;
  font-weight: 400;
  line-height: 1.43;
  letter-spacing: 0.01071em;
  background-color: #F5F5F5;
}
@media print {
  body {
    background-color: #fff;
  }
}
body::backdrop {
  background-color: #F5F5F5;
}
</style><style data-jss="" data-meta="MuiAppBar">
.MuiAppBar-root {
  width: 100%;
  display: flex;
  z-index: 1100;
  box-sizing: border-box;
  flex-shrink: 0;
  flex-direction: column;
}
.MuiAppBar-positionFixed {
  top: 0;
  left: auto;
  right: 0;
  position: fixed;
}
@media print {
  .MuiAppBar-positionFixed {
    position: absolute;
  }
}
.MuiAppBar-positionAbsolute {
  top: 0;
  left: auto;
  right: 0;
  position: absolute;
}
.MuiAppBar-positionSticky {
  top: 0;
  left: auto;
  right: 0;
  position: sticky;
}
.MuiAppBar-positionStatic {
  position: static;
  transform: translateZ(0);
}
.MuiAppBar-positionRelative {
  position: relative;
}
.MuiAppBar-colorDefault {
  color: rgba(0, 0, 0, 0.87);
  background-color: #f5f5f5;
}
.MuiAppBar-colorPrimary {
  color: #000000;
  background-color: #FFFFFF;
}
.MuiAppBar-colorSecondary {
  color: #fff;
  background-color: #f50057;
}
.MuiAppBar-colorInherit {
  color: inherit;
}
.MuiAppBar-colorTransparent {
  color: inherit;
  background-color: transparent;
}
</style><style data-jss="" data-meta="MuiToolbar">
.MuiToolbar-root {
  display: flex;
  position: relative;
  align-items: center;
}
.MuiToolbar-gutters {
  padding-left: 16px;
  padding-right: 16px;
}
@media (min-width:600px) {
  .MuiToolbar-gutters {
    padding-left: 24px;
    padding-right: 24px;
  }
}
.MuiToolbar-regular {
  min-height: 56px;
}
@media (min-width:0px) and (orientation: landscape) {
  .MuiToolbar-regular {
    min-height: 48px;
  }
}
@media (min-width:600px) {
  .MuiToolbar-regular {
    min-height: 64px;
  }
}
.MuiToolbar-dense {
  min-height: 48px;
}
</style><style data-jss="" data-meta="MuiIconButton">
.MuiIconButton-root {
  flex: 0 0 auto;
  color: rgba(0, 0, 0, 0.54);
  padding: 12px;
  overflow: visible;
  font-size: 1.5rem;
  text-align: center;
  transition: background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
  border-radius: 50%;
}
.MuiIconButton-root:hover {
  background-color: rgba(0, 0, 0, 0.04);
}
.MuiIconButton-root.Mui-disabled {
  color: rgba(0, 0, 0, 0.26);
  background-color: transparent;
}
@media (hover: none) {
  .MuiIconButton-root:hover {
    background-color: transparent;
  }
}
.MuiIconButton-edgeStart {
  margin-left: -12px;
}
.MuiIconButton-sizeSmall.MuiIconButton-edgeStart {
  margin-left: -3px;
}
.MuiIconButton-edgeEnd {
  margin-right: -12px;
}
.MuiIconButton-sizeSmall.MuiIconButton-edgeEnd {
  margin-right: -3px;
}
.MuiIconButton-colorInherit {
  color: inherit;
}
.MuiIconButton-colorPrimary {
  color: #FFFFFF;
}
.MuiIconButton-colorPrimary:hover {
  background-color: rgba(255, 255, 255, 0.04);
}
@media (hover: none) {
  .MuiIconButton-colorPrimary:hover {
    background-color: transparent;
  }
}
.MuiIconButton-colorSecondary {
  color: #f50057;
}
.MuiIconButton-colorSecondary:hover {
  background-color: rgba(245, 0, 87, 0.04);
}
@media (hover: none) {
  .MuiIconButton-colorSecondary:hover {
    background-color: transparent;
  }
}
.MuiIconButton-sizeSmall {
  padding: 3px;
  font-size: 1.125rem;
}
.MuiIconButton-label {
  width: 100%;
  display: flex;
  align-items: inherit;
  justify-content: inherit;
}
</style><style data-jss="" data-meta="MuiDrawer">
.MuiDrawer-docked {
  flex: 0 0 auto;
}
.MuiDrawer-paper {
  top: 0;
  flex: 1 0 auto;
  height: 100%;
  display: flex;
  outline: 0;
  z-index: 1200;
  position: fixed;
  overflow-y: auto;
  flex-direction: column;
  -webkit-overflow-scrolling: touch;
}
.MuiDrawer-paperAnchorLeft {
  left: 0;
  right: auto;
}
.MuiDrawer-paperAnchorRight {
  left: auto;
  right: 0;
}
.MuiDrawer-paperAnchorTop {
  top: 0;
  left: 0;
  right: 0;
  bottom: auto;
  height: auto;
  max-height: 100%;
}
.MuiDrawer-paperAnchorBottom {
  top: auto;
  left: 0;
  right: 0;
  bottom: 0;
  height: auto;
  max-height: 100%;
}
.MuiDrawer-paperAnchorDockedLeft {
  border-right: 1px solid rgba(0, 0, 0, 0.12);
}
.MuiDrawer-paperAnchorDockedTop {
  border-bottom: 1px solid rgba(0, 0, 0, 0.12);
}
.MuiDrawer-paperAnchorDockedRight {
  border-left: 1px solid rgba(0, 0, 0, 0.12);
}
.MuiDrawer-paperAnchorDockedBottom {
  border-top: 1px solid rgba(0, 0, 0, 0.12);
}
</style><style data-jss="" data-meta="MuiList">
.MuiList-root {
  margin: 0;
  padding: 0;
  position: relative;
  list-style: none;
}
.MuiList-padding {
  padding-top: 8px;
  padding-bottom: 8px;
}
.MuiList-subheader {
  padding-top: 0;
}
</style><style data-jss="" data-meta="MuiListItem">
.MuiListItem-root {
  width: 100%;
  display: flex;
  position: relative;
  box-sizing: border-box;
  text-align: left;
  align-items: center;
  padding-top: 8px;
  padding-bottom: 8px;
  justify-content: flex-start;
  text-decoration: none;
}
.MuiListItem-root.Mui-focusVisible {
  background-color: rgba(0, 0, 0, 0.08);
}
.MuiListItem-root.Mui-selected, .MuiListItem-root.Mui-selected:hover {
  background-color: rgba(0, 0, 0, 0.08);
}
.MuiListItem-root.Mui-disabled {
  opacity: 0.5;
}
.MuiListItem-container {
  position: relative;
}
.MuiListItem-dense {
  padding-top: 4px;
  padding-bottom: 4px;
}
.MuiListItem-alignItemsFlexStart {
  align-items: flex-start;
}
.MuiListItem-divider {
  border-bottom: 1px solid rgba(0, 0, 0, 0.12);
  background-clip: padding-box;
}
.MuiListItem-gutters {
  padding-left: 16px;
  padding-right: 16px;
}
.MuiListItem-button {
  transition: background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
}
.MuiListItem-button:hover {
  text-decoration: none;
  background-color: rgba(0, 0, 0, 0.04);
}
@media (hover: none) {
  .MuiListItem-button:hover {
    background-color: transparent;
  }
}
.MuiListItem-secondaryAction {
  padding-right: 48px;
}
</style><style data-jss="" data-meta="MuiListItemText">
.MuiListItemText-root {
  flex: 1 1 auto;
  min-width: 0;
  margin-top: 4px;
  margin-bottom: 4px;
}
.MuiListItemText-multiline {
  margin-top: 6px;
  margin-bottom: 6px;
}
.MuiListItemText-inset {
  padding-left: 56px;
}
</style><style data-jss="" data-meta="MuiListItemIcon">
.MuiListItemIcon-root {
  color: rgba(0, 0, 0, 0.54);
  display: inline-flex;
  min-width: 56px;
  flex-shrink: 0;
}
.MuiListItemIcon-alignItemsFlexStart {
  margin-top: 8px;
}
</style><style data-jss="" data-meta="MuiFab">
.MuiFab-root {
  color: rgba(0, 0, 0, 0.87);
  width: 56px;
  height: 56px;
  padding: 0;
  font-size: 0.875rem;
  min-width: 0;
  box-shadow: 0px 3px 5px -1px rgba(0,0,0,0.2),0px 6px 10px 0px rgba(0,0,0,0.14),0px 1px 18px 0px rgba(0,0,0,0.12);
  box-sizing: border-box;
  min-height: 36px;
  transition: background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
  font-family: "Roboto", "Helvetica", "Arial", sans-serif;
  font-weight: 500;
  line-height: 1.75;
  border-radius: 50%;
  letter-spacing: 0.02857em;
  text-transform: uppercase;
  background-color: #e0e0e0;
}
.MuiFab-root:active {
  box-shadow: 0px 7px 8px -4px rgba(0,0,0,0.2),0px 12px 17px 2px rgba(0,0,0,0.14),0px 5px 22px 4px rgba(0,0,0,0.12);
}
.MuiFab-root:hover {
  text-decoration: none;
  background-color: #d5d5d5;
}
.MuiFab-root.Mui-focusVisible {
  box-shadow: 0px 3px 5px -1px rgba(0,0,0,0.2),0px 6px 10px 0px rgba(0,0,0,0.14),0px 1px 18px 0px rgba(0,0,0,0.12);
}
.MuiFab-root.Mui-disabled {
  color: rgba(0, 0, 0, 0.26);
  box-shadow: none;
  background-color: rgba(0, 0, 0, 0.12);
}
@media (hover: none) {
  .MuiFab-root:hover {
    background-color: #e0e0e0;
  }
}
.MuiFab-root:hover.Mui-disabled {
  background-color: rgba(0, 0, 0, 0.12);
}
.MuiFab-label {
  width: 100%;
  display: inherit;
  align-items: inherit;
  justify-content: inherit;
}
.MuiFab-primary {
  color: #000000;
  background-color: #FFFFFF;
}
.MuiFab-primary:hover {
  background-color: #C2C2C2;
}
@media (hover: none) {
  .MuiFab-primary:hover {
    background-color: #FFFFFF;
  }
}
.MuiFab-secondary {
  color: #fff;
  background-color: #f50057;
}
.MuiFab-secondary:hover {
  background-color: #c51162;
}
@media (hover: none) {
  .MuiFab-secondary:hover {
    background-color: #f50057;
  }
}
.MuiFab-extended {
  width: auto;
  height: 48px;
  padding: 0 16px;
  min-width: 48px;
  min-height: auto;
  border-radius: 24px;
}
.MuiFab-extended.MuiFab-sizeSmall {
  width: auto;
  height: 34px;
  padding: 0 8px;
  min-width: 34px;
  border-radius: 17px;
}
.MuiFab-extended.MuiFab-sizeMedium {
  width: auto;
  height: 40px;
  padding: 0 16px;
  min-width: 40px;
  border-radius: 20px;
}
.MuiFab-colorInherit {
  color: inherit;
}
.MuiFab-sizeSmall {
  width: 40px;
  height: 40px;
}
.MuiFab-sizeMedium {
  width: 48px;
  height: 48px;
}
</style><style data-jss="" data-meta="makeStyles">
.jss1 {
  display: flex;
}
.jss2 {
  transition: margin 195ms cubic-bezier(0.4, 0, 0.6, 1) 0ms,width 195ms cubic-bezier(0.4, 0, 0.6, 1) 0ms;
}
.jss3 {
  width: calc(100% - 240px);
  transition: margin 225ms cubic-bezier(0.0, 0, 0.2, 1) 0ms,width 225ms cubic-bezier(0.0, 0, 0.2, 1) 0ms;
  margin-left: 240px;
}
.jss4 {
  margin-right: 16px;
}
.jss5 {
  display: none;
}
.jss6 {
  width: 240px;
  flex-shrink: 0;
}
.jss7 {
  width: 240px;
}
.jss8 {
  display: flex;
  padding: 0px 8px;
  min-height: 56px;
  align-items: center;
  justify-content: flex-end;
}
@media (min-width:0px) and (orientation: landscape) {
  .jss8 {
    min-height: 48px;
  }
}
@media (min-width:600px) {
  .jss8 {
    min-height: 64px;
  }
}
.jss9 {
  flex-grow: 1;
  max-width: 100%;
  min-height: 100vh;
  transition: margin 195ms cubic-bezier(0.4, 0, 0.6, 1) 0ms;
  margin-left: -240px;
  background-color: #FFFFFF;
}
.jss10 {
  max-width: 100%;
  min-height: 100vh;
  transition: margin 225ms cubic-bezier(0.0, 0, 0.2, 1) 0ms;
  margin-left: 0;
  background-color: #FFFFFF;
}
.jss11 {
  right: 16px;
  bottom: 16px;
  position: fixed;
}
</style><style data-jss="" data-meta="MuiChip">
.MuiChip-root {
  color: rgba(0, 0, 0, 0.87);
  border: none;
  cursor: default;
  height: 32px;
  display: inline-flex;
  outline: 0;
  padding: 0;
  font-size: 0.8125rem;
  box-sizing: border-box;
  transition: background-color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
  align-items: center;
  font-family: "Roboto", "Helvetica", "Arial", sans-serif;
  white-space: nowrap;
  border-radius: 16px;
  vertical-align: middle;
  justify-content: center;
  text-decoration: none;
  background-color: #e0e0e0;
}
.MuiChip-root.Mui-disabled {
  opacity: 0.5;
  pointer-events: none;
}
.MuiChip-root .MuiChip-avatar {
  color: #616161;
  width: 24px;
  height: 24px;
  font-size: 0.75rem;
  margin-left: 5px;
  margin-right: -6px;
}
.MuiChip-root .MuiChip-avatarColorPrimary {
  color: #000000;
  background-color: #C2C2C2;
}
.MuiChip-root .MuiChip-avatarColorSecondary {
  color: #fff;
  background-color: #c51162;
}
.MuiChip-root .MuiChip-avatarSmall {
  width: 18px;
  height: 18px;
  font-size: 0.625rem;
  margin-left: 4px;
  margin-right: -4px;
}
.MuiChip-sizeSmall {
  height: 24px;
}
.MuiChip-colorPrimary {
  color: #000000;
  background-color: #FFFFFF;
}
.MuiChip-colorSecondary {
  color: #fff;
  background-color: #f50057;
}
.MuiChip-clickable {
  cursor: pointer;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}
.MuiChip-clickable:hover, .MuiChip-clickable:focus {
  background-color: rgb(206, 206, 206);
}
.MuiChip-clickable:active {
  box-shadow: 0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);
}
.MuiChip-clickableColorPrimary:hover, .MuiChip-clickableColorPrimary:focus {
  background-color: rgb(234, 234, 234);
}
.MuiChip-clickableColorSecondary:hover, .MuiChip-clickableColorSecondary:focus {
  background-color: rgb(245, 20, 100);
}
.MuiChip-deletable:focus {
  background-color: rgb(206, 206, 206);
}
.MuiChip-deletableColorPrimary:focus {
  background-color: rgb(204, 204, 204);
}
.MuiChip-deletableColorSecondary:focus {
  background-color: rgb(247, 51, 120);
}
.MuiChip-outlined {
  border: 1px solid rgba(0, 0, 0, 0.23);
  background-color: transparent;
}
.MuiChip-clickable.MuiChip-outlined:hover, .MuiChip-clickable.MuiChip-outlined:focus, .MuiChip-deletable.MuiChip-outlined:focus {
  background-color: rgba(0, 0, 0, 0.04);
}
.MuiChip-outlined .MuiChip-avatar {
  margin-left: 4px;
}
.MuiChip-outlined .MuiChip-avatarSmall {
  margin-left: 2px;
}
.MuiChip-outlined .MuiChip-icon {
  margin-left: 4px;
}
.MuiChip-outlined .MuiChip-iconSmall {
  margin-left: 2px;
}
.MuiChip-outlined .MuiChip-deleteIcon {
  margin-right: 5px;
}
.MuiChip-outlined .MuiChip-deleteIconSmall {
  margin-right: 3px;
}
.MuiChip-outlinedPrimary {
  color: #FFFFFF;
  border: 1px solid #FFFFFF;
}
.MuiChip-clickable.MuiChip-outlinedPrimary:hover, .MuiChip-clickable.MuiChip-outlinedPrimary:focus, .MuiChip-deletable.MuiChip-outlinedPrimary:focus {
  background-color: rgba(255, 255, 255, 0.04);
}
.MuiChip-outlinedSecondary {
  color: #f50057;
  border: 1px solid #f50057;
}
.MuiChip-clickable.MuiChip-outlinedSecondary:hover, .MuiChip-clickable.MuiChip-outlinedSecondary:focus, .MuiChip-deletable.MuiChip-outlinedSecondary:focus {
  background-color: rgba(245, 0, 87, 0.04);
}
.MuiChip-icon {
  color: #616161;
  margin-left: 5px;
  margin-right: -6px;
}
.MuiChip-iconSmall {
  width: 18px;
  height: 18px;
  margin-left: 4px;
  margin-right: -4px;
}
.MuiChip-iconColorPrimary {
  color: inherit;
}
.MuiChip-iconColorSecondary {
  color: inherit;
}
.MuiChip-label {
  overflow: hidden;
  white-space: nowrap;
  padding-left: 12px;
  padding-right: 12px;
  text-overflow: ellipsis;
}
.MuiChip-labelSmall {
  padding-left: 8px;
  padding-right: 8px;
}
.MuiChip-deleteIcon {
  color: rgba(0, 0, 0, 0.26);
  width: 22px;
  cursor: pointer;
  height: 22px;
  margin: 0 5px 0 -6px;
  -webkit-tap-highlight-color: transparent;
}
.MuiChip-deleteIcon:hover {
  color: rgba(0, 0, 0, 0.4);
}
.MuiChip-deleteIconSmall {
  width: 16px;
  height: 16px;
  margin-left: -4px;
  margin-right: 4px;
}
.MuiChip-deleteIconColorPrimary {
  color: rgba(0, 0, 0, 0.7);
}
.MuiChip-deleteIconColorPrimary:hover, .MuiChip-deleteIconColorPrimary:active {
  color: #000000;
}
.MuiChip-deleteIconColorSecondary {
  color: rgba(255, 255, 255, 0.7);
}
.MuiChip-deleteIconColorSecondary:hover, .MuiChip-deleteIconColorSecondary:active {
  color: #fff;
}
.MuiChip-deleteIconOutlinedColorPrimary {
  color: rgba(255, 255, 255, 0.7);
}
.MuiChip-deleteIconOutlinedColorPrimary:hover, .MuiChip-deleteIconOutlinedColorPrimary:active {
  color: #FFFFFF;
}
.MuiChip-deleteIconOutlinedColorSecondary {
  color: rgba(245, 0, 87, 0.7);
}
.MuiChip-deleteIconOutlinedColorSecondary:hover, .MuiChip-deleteIconOutlinedColorSecondary:active {
  color: #f50057;
}
</style><style data-jss="" data-meta="makeStyles">
.jss202 {
  margin: 8px 4px;
}
</style><style data-jss="" data-meta="makeStyles">
.jss201 {
  height: 30px;
  margin: 8px 4px;
}
</style><style data-jss="" data-meta="makeStyles">
.jss167 {
  width: 100%;
  margin: 0;
  padding: 0px 16px;
  max-width: 800px;
}
@media (max-width:959.95px) {
  .jss167 {
    padding: 8px;
  }
}
.jss168 {
  width: 100%;
  max-width: 100%;
}
.jss169 {
  margin-top: 16px;
}
</style><style data-jss="" data-meta="makeStyles">
.jss170 {
  order: 2;
  width: 240px;
  display: none;
  padding: 8px;
  position: fixed;
  overflow-x: hidden;
  overflow-y: auto;
  flex-shrink: 0;
  overflow-wrap: break-word;
  list-style-type: none;
}
@media (min-width:960px) {
  .jss170 {
    display: block;
  }
}
.jss171 {
  margin-top: 16px;
  padding-left: 12px;
}
.jss172 {
  padding: 8px 0px 4px 8px;
  font-size: 14px;
  box-sizing: content-box;
}
.jss173 {
  margin: 0;
  padding: 0;
  list-style-type: none;
}
.jss174 {
  padding: 4px 0px 4px 8px;
  font-size: 13px;
  box-sizing: content-box;
  border-left: 4px solid transparent;
}
.jss174:hover {
  cursor: pointer;
  border-left: 4px solid #eeeeee;
}
.jss174.jss175, .jss174:active {
  border-left: 4px solid #bdbdbd;
}
</style><style data-jss="" data-meta="makeStyles">
.jss149 {
  display: flex;
  overflow: hidden;
  flex-wrap: wrap;
  padding-top: 8px;
  justify-content: space-around;
  background-color: #FFFFFF;
}
@media (max-width:959.95px) {
  .jss149 {
    padding: 8px;
  }
}
.jss150 {
  display: flex;
  overflow: hidden;
  flex-wrap: wrap;
  justify-content: flex-end;
  background-color: #FFFFFF;
}
@media (min-width:960px) {
  .jss150 {
    width: 240px;
  }
}
.jss151 {
  margin: 0;
  padding: 0;
}
@media (max-width:959.95px) {
  .jss151 {
    display: flex;
    overflow: hidden;
    flex-wrap: wrap;
  }
}
</style><link rel="stylesheet" type="text/css" href="/static/css/detail.ef17f79594051c627ba9.css"><script charset="utf-8" src="/static/js/detail.ef17f79594051c627ba9.js"></script><meta name="google-site-verification" content="s3PYm0fCo0ImPqqXoPLiUb_bFdlYODKw54VGSkcFgyE" data-react-helmet="true"><meta id="google-analytics" name="google-analytics" content="UA-68904127-2" data-react-helmet="true"><meta name="og:site_name" content="zexo.dev" data-react-helmet="true"><meta name="og:type" content="website" data-react-helmet="true"><meta name="og:title" itemprop="name" content="Spring 整合 Apache Shiro 实现各等级的权限管理" data-react-helmet="true"><meta name="og:description" itemprop="description" content="前几个月在做一个常规的权限隔离功能的时候,恰好使用过 Apache Shiro. Apache Shiro 是一款 Java 的安全框架,通常用作 Web 应用的权限校验,身份验证.Apache Shiro is a powerful and easy-to-use Java security framework that performs authentication, authorization, cryptography, and session management. With Shiro’s easy-to-understand API, you can quickly and easily secure any application – from the smallest mobile applications to the largest web and enterprise applications.
" data-react-helmet="true"><meta name="og:image" itemprop="image" content="https:/zexo.dev/posts/2015/10/25/apache-shiro-spring-integration/cover.png" data-react-helmet="true"><meta name="og:type" content="article" data-react-helmet="true"><meta name="description" itemprop="description" content="前几个月在做一个常规的权限隔离功能的时候,恰好使用过 Apache Shiro. Apache Shiro 是一款 Java 的安全框架,通常用作 Web 应用的权限校验,身份验证.Apache Shiro is a powerful and easy-to-use Java security framework that performs authentication, authorization, cryptography, and session management. With Shiro’s easy-to-understand API, you can quickly and easily secure any application – from the smallest mobile applications to the largest web and enterprise applications.
" data-react-helmet="true"><script type="application/ld+json" data-react-helmet="true">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://zexo.dev","name":"Home","position":1},{"@type":"ListItem","item":"https://zexo.dev/posts","name":"Posts","position":2},{"@type":"ListItem","item":"https://zexo.dev/posts/2015/10/25/apache-shiro-spring-integration","name":"Spring 整合 Apache Shiro 实现各等级的权限管理","position":3}]}</script></head><body><div id="app"><div class="jss1"><header class="MuiPaper-root MuiAppBar-root MuiAppBar-positionFixed MuiAppBar-colorPrimary jss2 mui-fixed MuiPaper-elevation4"><div class="MuiToolbar-root MuiToolbar-regular MuiToolbar-gutters"><button class="MuiButtonBase-root MuiIconButton-root jss4 MuiIconButton-colorInherit MuiIconButton-edgeStart" tabindex="0" type="button" aria-label="open drawer"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></span><span class="MuiTouchRipple-root"></span></button><h6 class="MuiTypography-root MuiTypography-h6 MuiTypography-noWrap">zexo.dev</h6></div></header><div class="MuiDrawer-root MuiDrawer-docked jss6"><div class="MuiPaper-root MuiDrawer-paper jss7 MuiDrawer-paperAnchorLeft MuiDrawer-paperAnchorDockedLeft MuiPaper-elevation0" style="visibility: hidden; transform: translateX(-240px);"><div class="jss8"><button class="MuiButtonBase-root MuiIconButton-root" tabindex="0" type="button"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg></span><span class="MuiTouchRipple-root"></span></button></div><hr class="MuiDivider-root"><ul class="MuiList-root MuiList-padding"><a class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false" href="/"><div class="MuiListItemIcon-root"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg></div><div class="MuiListItemText-root"><span class="MuiTypography-root MuiListItemText-primary MuiTypography-body1 MuiTypography-displayBlock">Home</span></div><span class="MuiTouchRipple-root"></span></a><a class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false" href="/categories"><div class="MuiListItemIcon-root"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2l-5.5 9h11z"></path><circle cx="17.5" cy="17.5" r="4.5"></circle><path d="M3 13.5h8v8H3z"></path></svg></div><div class="MuiListItemText-root"><span class="MuiTypography-root MuiListItemText-primary MuiTypography-body1 MuiTypography-displayBlock">Categories</span></div><span class="MuiTouchRipple-root"></span></a><a class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false" href="/tags"><div class="MuiListItemIcon-root"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z"></path></svg></div><div class="MuiListItemText-root"><span class="MuiTypography-root MuiListItemText-primary MuiTypography-body1 MuiTypography-displayBlock">Tags</span></div><span class="MuiTouchRipple-root"></span></a><a class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false" href="/pages/about"><div class="MuiListItemIcon-root"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></div><div class="MuiListItemText-root"><span class="MuiTypography-root MuiListItemText-primary MuiTypography-body1 MuiTypography-displayBlock">About Me</span></div><span class="MuiTouchRipple-root"></span></a><a class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false" href="/pages/projects"><div class="MuiListItemIcon-root"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></div><div class="MuiListItemText-root"><span class="MuiTypography-root MuiListItemText-primary MuiTypography-body1 MuiTypography-displayBlock">Projects</span></div><span class="MuiTouchRipple-root"></span></a></ul></div></div><main class="jss9"><div class="MuiToolbar-root MuiToolbar-regular jss8 MuiToolbar-gutters" id="back-to-top-anchor"></div><div class="MuiContainer-root jss149 MuiContainer-maxWidthLg"><div class="jss151"><div class="jss160"><div class="MuiPaper-root jss161 MuiPaper-elevation0 MuiPaper-rounded"><nav class="MuiTypography-root MuiBreadcrumbs-root jss162 MuiTypography-body1 MuiTypography-colorTextSecondary" aria-label="breadcrumb"><ol class="MuiBreadcrumbs-ol"><li class="MuiBreadcrumbs-li"><a class="MuiTypography-root MuiLink-root MuiLink-underlineHover MuiTypography-colorInherit" href="/">Home</a></li><li aria-hidden="true" class="MuiBreadcrumbs-separator"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></li><li class="MuiBreadcrumbs-li"><a class="MuiTypography-root MuiLink-root MuiLink-underlineHover MuiTypography-colorInherit" href="/posts">Posts</a></li><li aria-hidden="true" class="MuiBreadcrumbs-separator"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></li><li class="MuiBreadcrumbs-li"><a class="MuiTypography-root MuiLink-root MuiLink-underlineHover MuiTypography-colorTextPrimary" href="/posts/2015/10/25/apache-shiro-spring-integration">Spring 整合 Apache Shiro 实现各等级的权限管理</a></li></ol></nav></div></div><div class="jss167"><picture><source type="image/webp" data-was-processed="false"><img class="jss168 lazy loaded" data-ll-status="loaded" alt="Spring 整合 Apache Shiro 实现各等级的权限管理" src="/posts/2015/10/25/apache-shiro-spring-integration/cover.png"></picture><div class="MuiTypography-root markdown-body MuiTypography-body1"><h1 id="spring-整合-apache-shiro-实现各等级的权限管理">Spring 整合 Apache Shiro 实现各等级的权限管理</h1>
<h2 id="background">Background</h2>
<p>前几个月在做一个常规的权限隔离功能的时候,恰好使用过 Apache Shiro. Apache Shiro 是一款 Java 的安全框架,通常用作 Web 应用的权限校验,身份验证.</p>
<blockquote>
<p>Apache Shiro is a powerful and easy-to-use Java security framework that performs authentication, authorization, cryptography, and session management. With Shiro’s easy-to-understand API, you can quickly and easily secure any application – from the smallest mobile applications to the largest web and enterprise applications.</p>
</blockquote>
<p>在参考过 IBM 开发社区关于 Shiro 的博客 一篇文章 <a href="https://www.ibm.com/developerworks/cn/java/j-lo-shiro/">在 Web 项目中应用 Apache Shiro</a> 与开涛博客的一个跟我学 Shiro 系列文章 <a href="https://jinnianshilongnian.iteye.com/blog/2024723">开涛博客-跟我学 Shiro</a></p>
<blockquote>
<p>不得不说的是 IBM Developer 社区的文章一向属于生动易懂. 但是上面的这篇讲得并没有之前推荐的讲 Spring-DataJPA 的那篇文章那样浅显, 于是才有了现在这份笔记</p>
</blockquote>
<h2 id="权限控制">权限控制</h2>
<p>我所接触到的权限控制大概可以分成两个级别 URL 和方法级别.</p>
<p>以常见的论坛用户来举例.论坛用户简要的分成两种 管理员<code>Admin</code>,普通用户<code>Normal</code>. 其中管理员能够进入用户管理,帖子管理的页面进行 CRUD 操作. 普通用户则只能进行自己帖子的 CRU 操作,以及顶贴什么的.</p>
<p>如果只进行 URL 级别的拦截,只需要在每一个 URL 的访问时 获取用户的角色是<code>Admin</code>还是<code>Normal</code>即可.</p>
<p>如果是进行方法级别的拦截,则可能根据功能的设计衍生出很多设计方案(一眼就能想到的大概是树状,平行等). 但是由于跟数据库的设计密切相关,所以这个级别不细讲. 言归正传(不知道是不是看 light 大大博客看多了,语气有点奇怪),下面结合上面的论坛用户的一个场景进行逻辑与代码的讲解</p>
<h3 id="url-级别的权限控制">URL 级别的权限控制</h3>
<h4 id="业务场景假设">业务场景假设</h4>
<p>首先,我们假设有以下几种种 URL</p>
<pre class="hljs"><code>/user/create        //用户创建,Admin专属
/post/create        //发帖 Admin,Normal共有
/login              //登陆
/logout             //注销
</code></pre>
<h4 id="shiro-基本配置">Shiro 基本配置</h4>
<h5 id="maven">Maven</h5>
<p><code>$&lt;shiro.version&gt;</code>请自行替换成当前的最新版本</p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${shiro.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${shiro.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${shiro.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${shiro.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h5 id="webxml">web.xml</h5>
<p>为了实现与 Spring 同一个级别的 URL 拦截,需要将 Shiro 的 Filter 配置在 Spring MVC 的 Dispatcher Servlet 同一个级别</p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>shiroFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>targetFilterLifecycle<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>shiroFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span>
</code></pre>
<h5 id="spring-applicationcontextxml">Spring ApplicationContext.xml</h5>
<p>在与 Spring 进行整合的时候,为了方便拼切配置,在 Spring 里面导入另一份专用于 Shiro 的 xml 配置</p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"config/security/applicationContext-shiro-captcha.xml"</span>/&gt;</span>
</code></pre>
<h5 id="spring-applicationcontext-shiro-captchaxml">Spring applicationContext-shiro-captcha.xml</h5>
<p>先将整个 shiro 的 xml 配置贴出来,接下来在逐一解说其内容</p>
<pre class="hljs"><code><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"https://www.springframework.org/schema/beans"</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"https://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"https://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans-3.1.xsd"</span>
       <span class="hljs-attr">default-lazy-init</span>=<span class="hljs-string">"true"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Shiro安全配置<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Shiro's main business-tier object for web-enabled applications --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"securityManager"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.apache.shiro.web.mgt.DefaultWebSecurityManager"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"realm"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"shiroRealm"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cacheManager"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"shiroEhcacheManager"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 項目自定义的Realm --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"shiroRealm"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.quariuslt.service.security.BookingShiroRealm"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"loginSessionService"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"loginSessionService"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"userService"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"userService"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cacheManager"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"shiroEhcacheManager"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 用户授权信息Cache, 采用EhCache --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"shiroEhcacheManager"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.apache.shiro.cache.ehcache.EhCacheManager"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cacheManagerConfigFile"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"classpath:config/security/ehcache-shiro.xml"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 保证实现了Shiro内部lifecycle函数的bean执行 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lifecycleBeanPostProcessor"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.apache.shiro.spring.LifecycleBeanPostProcessor"</span>/&gt;</span>


    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"securityManager"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"securityManager"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"captchaFilter"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.quariuslt.service.security.CaptchaFormAuthenticationFilter"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"adminPermissionFilter"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.quariuslt.service.security.AdminPermissionFilter"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"normalPermissionFilter"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.quariuslt.service.security.NormalPermissionFilter"</span>/&gt;</span>

    <span class="hljs-comment">&lt;!-- Shiro Filter --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"shiroFilter"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.apache.shiro.spring.web.ShiroFilterFactoryBean"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"securityManager"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"securityManager"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"loginUrl"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/login"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"successUrl"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/booking/search"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"unauthorizedUrl"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"filters"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"authc"</span> <span class="hljs-attr">value-ref</span>=<span class="hljs-string">"captchaFilter"</span>/&gt;</span>
                <span class="hljs-comment">&lt;!--&lt;entry key="roles[admin]" value-ref="captchaFilter"/&gt;--&gt;</span>
                <span class="hljs-comment">&lt;!--&lt;entry key="roles[normal]" value-ref="captchaFilter"/&gt;--&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"filterChainDefinitions"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>
                /=authc
                /register = anon
                /forgot =anon
                /login = anon
                /login/action* = anon
                /logout = logout
                /js/** = anon
                /rest/**=anon
                /image/**=anon
                /jawr_loader.js=anon
                /user/create=roles[admin]
                /post/create/**=roles[normal|admin]
                /** =authc
            <span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span>
</code></pre>
<h4 id="配置详解">配置详解</h4>
<p>首先要理解一件事情,就是 Shiro 的权限控制 源自于 Web.xml 的 Filter,在 Filter 中获取目标 URL 的请求,解析以达到根据请求是否到达下一集 Filter 的作用. 再要理解一件约定大于配置的问题,了解 Shiro 的一些默认配置解说.</p>
<p>在贴出来的<code>shiro-captcha.xml</code>配置代码中:</p>
<pre class="hljs"><code><span class="hljs-comment">&lt;!-- Shiro Filter --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"shiroFilter"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.apache.shiro.spring.web.ShiroFilterFactoryBean"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"securityManager"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"securityManager"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"loginUrl"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/login"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"successUrl"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/booking/search"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"unauthorizedUrl"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"filters"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"authc"</span> <span class="hljs-attr">value-ref</span>=<span class="hljs-string">"captchaFilter"</span>/&gt;</span>
            <span class="hljs-comment">&lt;!--&lt;entry key="roles[admin]" value-ref="captchaFilter"/&gt;--&gt;</span>
            <span class="hljs-comment">&lt;!--&lt;entry key="roles[normal]" value-ref="captchaFilter"/&gt;--&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"filterChainDefinitions"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>
            /=authc
            /register = anon
            /forgot =anon
            /login = anon
            /login/action* = anon
            /logout = logout
            /js/** = anon
            /rest/**=anon
            /image/**=anon
            /jawr_loader.js=anon
            /user/create=roles[admin]
            /post/create/**=roles[normal|admin]
            /** =authc
        <span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
</code></pre>
<p>先来看<code>&lt;property name="filterChainDefinitions"&gt;</code>中的属性. &lt;values&gt;的内容,其实是 url 对应权限的一些 mapping.表示对应的 url mapping 需要对应的权限. 其中<code>authc</code>,<code>anon</code>,<code>logout</code>样例中提及的这三个,是 Shiro 自己的默认配置</p>
<blockquote>
<p><code>authc</code>表示,这这个 mapping 代表的 url 需要登陆之后才能查看 <code>anon</code>表示,这个 mapping 代表的 url 全部放行,所以可以看到所有 js 文件与 image 文件都被放行了 <code>logout</code> 表示这个 mapping 代表的 url 将进行一次注销操作,在浏览器客户端进行的是 session 的注销,在服务器端则是进行缓存的删除</p>
</blockquote>
<p>其中 <code>roles[admin],roles[normal|admin]</code> 则是自己定义的过滤规则. 表示<code>/user/create</code>只有角色包含<code>admin</code>的有权限访问且<code>/post/create</code>则是角色是<code>admin</code>或<code>normal</code>的有权限访问</p>
<h5 id="登录与注销">登录与注销</h5>
<h6 id="登录">登录</h6>
<p>对于所有需要登录的 URL 可以通过 <code>authc</code>一个拦截器来拦截在未登录的状态下,所有所有需要登录的 URL 都是自动跳转到上面 XML 所配置的<code>loginUrl</code>之中. 当然这里返回的是 一个对 <code>/login</code>路径的 get 请求</p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"loginUrl"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/login"</span>/&gt;</span>
</code></pre>
<h6 id="注销">注销</h6>
<p>注销也很简单,只要任意 url 能够跳转到<code>/logout</code>,便会自动注销.</p>
<h5 id="同步登录与异步登陆">同步登录与异步登陆</h5>
<p>其实在 Shiro 的配置中,通过阅读源码可以看出,其实<code>loginUrl</code>一个属性,代表的是当 Method=Get 的请求到达其值对应的 url(/login)时,返回登录的页面. 当 Method=Post 的请求到达其值对应的 url(/login)时,进入到的就是 Shiro 本身的登陆操作该操作,通过读取<code>securityManager</code>的配置,</p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"securityManager"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"securityManager"</span>/&gt;</span>
</code></pre>
<p>通过自定义的 realm <code>BookingShiroRealm</code></p>
<blockquote>
<p>此处<code>BookingShiroRealm</code>是自己定义的名称,只是为了符合但是的业务需要起的名字</p>
</blockquote>
<pre class="hljs"><code><span class="hljs-comment">&lt;!-- Shiro's main business-tier object for web-enabled applications --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"securityManager"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.apache.shiro.web.mgt.DefaultWebSecurityManager"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"realm"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"shiroRealm"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cacheManager"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"shiroEhcacheManager"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 項目自定义的Realm --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"shiroRealm"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.quariuslt.service.security.BookingShiroRealm"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"loginSessionService"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"loginSessionService"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"userService"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"userService"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cacheManager"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"shiroEhcacheManager"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
</code></pre>
<p>接下来解说一下 <code>BookingShiroRealm.java</code> 的内容</p>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookingShiroRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthorizingRealm</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String LOGIN_SESSION_NAME=<span class="hljs-string">"loginSession"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String SIMPLE_AUTHORIZATION_INFO=<span class="hljs-string">"simpleAuthorizationInfo"</span>;

    <span class="hljs-keyword">private</span> LoginSessionService loginSessionService;

    <span class="hljs-keyword">private</span> UserService userService;


    <span class="hljs-function"><span class="hljs-keyword">public</span> LoginSessionService <span class="hljs-title">getLoginSessionService</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> loginSessionService;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLoginSessionService</span><span class="hljs-params">(LoginSessionService loginSessionService)</span> </span>{
        <span class="hljs-keyword">this</span>.loginSessionService = loginSessionService;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> UserService <span class="hljs-title">getUserService</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> userService;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserService</span><span class="hljs-params">(UserService userService)</span> </span>{
        <span class="hljs-keyword">this</span>.userService = userService;
    }

    <span class="hljs-comment">/*授权信息*/</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principals)</span> </span>{
        LoginSession loginSession = (LoginSession) principals.fromRealm(getName()).iterator().next();
        <span class="hljs-keyword">if</span>(SecurityUtils.getSubject().getSession().getAttribute(LOGIN_SESSION_NAME)==<span class="hljs-keyword">null</span>){
            SecurityUtils.getSubject().getSession().setAttribute(LOGIN_SESSION_NAME, loginSession);
        }
        <span class="hljs-keyword">if</span>(SecurityUtils.getSubject().getSession().getAttribute(SIMPLE_AUTHORIZATION_INFO)==<span class="hljs-keyword">null</span>){

            UserDto userDto=userService.findUserById(loginSession.getUserId());
            <span class="hljs-keyword">if</span> (userDto != <span class="hljs-keyword">null</span>) {
                SimpleAuthorizationInfo info = <span class="hljs-keyword">new</span> SimpleAuthorizationInfo();
                Set&lt;RoleDto&gt; roleDtoSet=userService.getUserRolesByUserId(userDto.getId());
                <span class="hljs-keyword">for</span>(RoleDto roleDto:roleDtoSet){
                    info.addRole(roleDto.getName().toLowerCase());
                }

                SecurityUtils.getSubject().getSession().setAttribute(SIMPLE_AUTHORIZATION_INFO, info);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
            }
        }
        <span class="hljs-keyword">return</span> (AuthorizationInfo)SecurityUtils.getSubject().getSession().getAttribute(SIMPLE_AUTHORIZATION_INFO);
    }

    <span class="hljs-comment">/*认证信息*/</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken authenticationToken)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>{
        System.out.println(<span class="hljs-string">"Come to BookingShiroRealm"</span>);
        UsernamePasswordToken token=(UsernamePasswordToken)authenticationToken;
        String userId=token.getUsername();
        String cryptedPassword= String.valueOf(token.getPassword());
        <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(userId)){
            UserDto targetUser=userService.getByUserId(userId);
            System.out.println(<span class="hljs-string">"TargetUser:"</span>+userId+<span class="hljs-string">" InputPassWord:"</span>+cryptedPassword+<span class="hljs-string">" DB PassWord:"</span>+targetUser.getCryptedPassword());
            <span class="hljs-keyword">if</span>(cryptedPassword.equals(targetUser.getCryptedPassword())){
                System.out.println(<span class="hljs-string">"BookingShiroRealm:Login Success"</span>);
                LoginSession loginSession=<span class="hljs-keyword">new</span> LoginSession(targetUser.getId(), targetUser.getUserId(),targetUser.getEmail(),SecurityUtils.getSubject().getSession().getHost());
                loginSessionService.clearSessionByUserId(userId);
                loginSessionService.save(loginSession);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SimpleAuthenticationInfo(loginSession,targetUser.getCryptedPassword().toCharArray(),getName());
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }
}

</code></pre>
<p><code>AuthorizingRealm</code>是 Shiro 负责身份认证的抽象类. 需要实现其<code>doGetAuthenticationInfo</code>方法,实现 对提交过来的用户名/密码 等账号信息,跟数据库进行交互判定登陆是否成功的过程. 和实现其<code>doGetAuthorizationInfo</code>方法,实现对需要登陆之后 对权限的认证.</p>
<p>在说到登陆的校验之前,可以看到在<code>doGetAuthenticationInfo</code>方法里面 有一个 authenticationToken.里面包含了登陆传递过来的用户名和密码信息.这里又是怎么来的呢. 此时返回来回到 Spring 配置 Shiro 的 xml <code>applicationContext-shiro-captcha.xml</code> 会发现</p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"filters"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"authc"</span> <span class="hljs-attr">value-ref</span>=<span class="hljs-string">"captchaFilter"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"roles[admin]"</span> <span class="hljs-attr">value-ref</span>=<span class="hljs-string">"captchaFilter"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"roles[normal]"</span> <span class="hljs-attr">value-ref</span>=<span class="hljs-string">"captchaFilter"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
</code></pre>
<p>里面会有一个<code>captchaFilter</code>, 指向其注入的类 <code>CaptchaFormAuthenticationFilter.java</code></p>
<p>附上<code>CaptchaFormAuthenticationFilter</code>代码</p>
<pre class="hljs"><code><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CaptchaFormAuthenticationFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FormAuthenticationFilter</span> </span>{

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String DEFAULT_CAPTCHA_PARAM = <span class="hljs-string">"captcha"</span>;

    <span class="hljs-keyword">private</span> String captchaParam = DEFAULT_CAPTCHA_PARAM;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getCaptchaParam</span><span class="hljs-params">()</span> </span>{

        <span class="hljs-keyword">return</span> captchaParam;

    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> String <span class="hljs-title">getCaptcha</span><span class="hljs-params">(ServletRequest request)</span> </span>{

        <span class="hljs-keyword">return</span> WebUtils.getCleanParam(request, getCaptchaParam());

    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">onLoginFailure</span><span class="hljs-params">(AuthenticationToken token, AuthenticationException e, ServletRequest request, ServletResponse response)</span> </span>{
        setFailureAttribute(request, e);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setFailureAttribute</span><span class="hljs-params">(ServletRequest request, AuthenticationException ae)</span> </span>{
        String className = ae.getClass().getName();
        request.setAttribute(getFailureKeyAttribute(), className);
    }

    <span class="hljs-comment">//这里进行密码的加密</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> CaptchaUsernamePasswordToken <span class="hljs-title">createToken</span><span class="hljs-params">(ServletRequest request, ServletResponse response)</span> </span>{
        System.out.println(<span class="hljs-string">"Come to CreateToken"</span>);
        String username = getUsername(request);
        String password = getPassword(request);
        String captcha = getCaptcha(request);
        <span class="hljs-keyword">boolean</span> rememberMe = isRememberMe(request);
        String host = getHost(request);

        System.out.println(<span class="hljs-string">"Captcha UserName(UserId):"</span> + username);
        System.out.println(<span class="hljs-string">"Captcha Password:"</span> + password);
        System.out.println(<span class="hljs-string">"Captcha RememberMe:"</span> + rememberMe);


        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CaptchaUsernamePasswordToken(username,
                password.toCharArray(), rememberMe, host, captcha);

    }


    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">executeLogin</span><span class="hljs-params">(ServletRequest request, ServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        CaptchaUsernamePasswordToken token = createToken(request, response);

        <span class="hljs-keyword">try</span> {
            System.out.println(<span class="hljs-string">"Execute Login~"</span>);
            Subject subject = getSubject(request, response);
            subject.login(token);

            <span class="hljs-keyword">return</span> onLoginSuccess(token,subject, request, response);
        } <span class="hljs-keyword">catch</span> (AuthenticationException e) {
            <span class="hljs-keyword">return</span> onLoginFailure(token,e, request, response);
        }
    }
}
</code></pre>
<p>继承<code>FormAuthenticationFilter</code>的<code>CaptchaFormAuthenticationFilter</code>并重写其<code>CaptchaUsernamePasswordToken</code>方法. 用于通过<code>/login</code>的 POST 方式提交过来的时候,便会先经过此 filter 的<code>createToken</code>方法进行 token 的生成</p>
<p>假设有一个登陆页面的<code>/login</code>使用同步提交方式,即通过页面的 form 表单,<code>action="/login"</code>,<code>method="POST"</code>提交到后台,触发流程是</p>
<blockquote>
<ol>
<li>到达 <code>FormAuthenticationFilter</code> 根据表单 生成 Token.</li>
<li>调用 Shiro 专门处理认证的 <code>subject</code>其<code>login</code>方法进行登陆</li>
<li><code>login</code>方法 通过调用 自定义的<code>BookingShiroRealm</code>方法所实现的顶级接口 来实现对数据库的信息的读取</li>
<li>判定登陆用户名与密码 匹配之后,可以通过 Shiro 自己配置的缓存保存认证信息.</li>
</ol>
</blockquote>
<p>但是在这个时代,还通过同步登陆 实在是太 TM 捞了,其实异步登陆提交,只需要 手动调用 subject.login 方法即可将第一步到达<code>FormAuthenticationFilter</code>的 token 手动生成</p>
<p>异步登陆的实现代码 大概如下(以 Controller 为例)</p>
<pre class="hljs"><code><span class="hljs-meta">@RequestMapping(value = "/action", method = RequestMethod.POST,produces = MediaType.APPLICATION_JSON_VALUE)</span>
<span class="hljs-meta">@ResponseBody</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> LoginMessage <span class="hljs-title">loginAction</span><span class="hljs-params">(
        <span class="hljs-meta">@RequestParam(value = "username")</span> String username,
        <span class="hljs-meta">@RequestParam(value = "password")</span> String password,
        <span class="hljs-meta">@RequestParam(value = "rememberMe", required = false, defaultValue = "false")</span> <span class="hljs-keyword">boolean</span> rememberMe,
        ServletRequest request)</span> </span>{
    LoginMessage loginMessage = <span class="hljs-keyword">new</span> LoginMessage(BKGConstants.ActionStatus.FAILURE.getDescription());
    Subject subject = SecurityUtils.getSubject();


    <span class="hljs-comment">//尝试获取 跳转到Login前的那个页面的url</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">null</span> != WebUtils.getSavedRequest(request)) {
        String requestURI= WebUtils.getSavedRequest(request).getRequestURI();
        loginMessage.setRedirect(requestURI);
    }

    <span class="hljs-keyword">try</span> {
        String salt=userService.getByUserId(username).getSalt();
        UsernamePasswordToken token = <span class="hljs-keyword">new</span> UsernamePasswordToken(username, EncryptUtil.encrypt(password,salt));
        subject.login(token);
        loginMessage.setStatus(BKGConstants.ActionStatus.SUCCESS.getDescription());

        <span class="hljs-comment">//尝试判断 用户是不是第一次登陆</span>
        UserDto currentUser=userService.getByUserId(username);
        <span class="hljs-keyword">if</span> (currentUser.getActive().equals(BKGConstants.UserAccountStatus.FIRST_LOGIN.getIndex())){
            String redirectPath=request.getServletContext().getContextPath()+<span class="hljs-string">"/user/password/reset"</span>;
            loginMessage.setRedirect(redirectPath);
        }


    } <span class="hljs-keyword">catch</span> (UnknownAccountException e) {
        loginMessage.setMessage(BKGConstants.LoginFailureMessage.PASSWORD_WRONG.getDescription());
    } <span class="hljs-keyword">catch</span> (IncorrectCredentialsException |NullPointerException e) {
        loginMessage.setMessage(BKGConstants.LoginFailureMessage.USER_NOT_EXIST.getDescription());
    } <span class="hljs-keyword">catch</span> (AuthenticationException e) {
        loginMessage.setMessage(BKGConstants.LoginFailureMessage.ACCOUNT_LOCK.getDescription());
    }
    <span class="hljs-keyword">return</span> loginMessage;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginMessage</span> </span>{
    <span class="hljs-keyword">private</span> String status;
    <span class="hljs-keyword">private</span> String message;
    <span class="hljs-keyword">private</span> String redirect;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LoginMessage</span><span class="hljs-params">(String status)</span> </span>{
        <span class="hljs-keyword">this</span>.status = status;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getStatus</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> status;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setStatus</span><span class="hljs-params">(String status)</span> </span>{
        <span class="hljs-keyword">this</span>.status = status;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getMessage</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> message;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMessage</span><span class="hljs-params">(String message)</span> </span>{
        <span class="hljs-keyword">this</span>.message = message;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getRedirect</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> redirect;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRedirect</span><span class="hljs-params">(String redirect)</span> </span>{
        <span class="hljs-keyword">this</span>.redirect = redirect;
    }
}
</code></pre>
<h5 id="角色校验">角色校验</h5>
<p>登陆的时候,其实只是实现了 <code>登陆认证</code>,<code>缓存登录信息</code>的过程. 并没有实现,<code>权限赋予</code>的过程.只有第一次遇到 需要登陆且特定权限的 url 的时候,才会请求后台是否有进入对应 url 的权限.</p>
<p>在讲权限之前,概括一下数据库的设计</p>
<pre class="hljs"><code><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">USERS</span>
(
    <span class="hljs-keyword">ID</span> <span class="hljs-built_in">BIGINT</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,
    ACTIVE <span class="hljs-built_in">BIT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    ADDRESS <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">300</span>),
    CITY <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">50</span>),
    COMPANY <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">20</span>),
    COUNTRY <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">50</span>),
    CRYPTED_PASSWORD <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">255</span>),
    DEPARTMENT <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">20</span>),
    DISPLAY_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">128</span>),
    EMAIL <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">60</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    FAX <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">100</span>),
    FIRST_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">40</span>),
    GENDER <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">6</span>),
    JOBTITLE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">100</span>),
    LAST_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">40</span>),
    LOCATION <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">50</span>),
    MIDDLE_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">40</span>),
    OFFICE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">20</span>),
    OFFICECODE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">22</span>),
    PHONE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">128</span>),
    <span class="hljs-keyword">SALT</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    STAFFID <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">20</span>),
    STAFFROLE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">15</span>),
    TERRITORY <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">100</span>),
    USERID <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
);


<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">ROLES</span>
(
    <span class="hljs-keyword">ID</span> <span class="hljs-built_in">BIGINT</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,
    DESCRIPTION <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">255</span>),
    <span class="hljs-keyword">NAME</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">INDEX</span> UK_OFX66KERUAPI6VYQPV6F2OR37 <span class="hljs-keyword">ON</span> <span class="hljs-keyword">ROLES</span> (<span class="hljs-keyword">NAME</span>);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> ROLE_USER
(
    ROLE_ID <span class="hljs-built_in">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    USER_ID <span class="hljs-built_in">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    PRIMARY <span class="hljs-keyword">KEY</span> (ROLE_ID, USER_ID),
    <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (ROLE_ID) <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">ROLES</span> (<span class="hljs-keyword">ID</span>),
    <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (USER_ID) <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">USERS</span> (<span class="hljs-keyword">ID</span>)
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> FK_NJAJEL6A2Q8TR36EMB9L8VW7N <span class="hljs-keyword">ON</span> ROLE_USER (USER_ID);

</code></pre>
<p>数据库有三个表 <code>USERS</code>,<code>ROLES</code>,<code>USER_ROLE</code> 其实在设计上<code>User</code>表跟<code>ROLE</code>表是多对多的关系,即 User 里面有一个 Set&lt;Role&gt;,Role 里面也有一个 Set&lt;User&gt; 通过中间表<code>USER_ROLE</code>来实现多对多关联.</p>
<p>下面来看 身份认证的具体实现 <code>BookingShiroRealm.java</code></p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principals)</span> </span>{
    LoginSession loginSession = (LoginSession) principals.fromRealm(getName()).iterator().next();
    <span class="hljs-keyword">if</span>(SecurityUtils.getSubject().getSession().getAttribute(LOGIN_SESSION_NAME)==<span class="hljs-keyword">null</span>){
        SecurityUtils.getSubject().getSession().setAttribute(LOGIN_SESSION_NAME, loginSession);
    }
    <span class="hljs-keyword">if</span>(SecurityUtils.getSubject().getSession().getAttribute(SIMPLE_AUTHORIZATION_INFO)==<span class="hljs-keyword">null</span>){

        UserDto userDto=userService.findUserById(loginSession.getUserId());
        <span class="hljs-keyword">if</span> (userDto != <span class="hljs-keyword">null</span>) {
            SimpleAuthorizationInfo info = <span class="hljs-keyword">new</span> SimpleAuthorizationInfo();
            Set&lt;RoleDto&gt; roleDtoSet=userService.getUserRolesByUserId(userDto.getId());
            <span class="hljs-keyword">for</span>(RoleDto roleDto:roleDtoSet){
                info.addRole(roleDto.getName().toLowerCase());
            }

            SecurityUtils.getSubject().getSession().setAttribute(SIMPLE_AUTHORIZATION_INFO, info);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        }
    }
    <span class="hljs-keyword">return</span> (AuthorizationInfo)SecurityUtils.getSubject().getSession().getAttribute(SIMPLE_AUTHORIZATION_INFO);
}
</code></pre>
<p>通过</p>
<pre class="hljs"><code>Subject.getSession().setAttribute(SIMPLE_AUTHORIZATION_INFO,info)
</code></pre>
<p>来实现一个 根据通过已经登陆的用户,获取其在数据库中所具有的角色的名字的集合 生成字符串,然后存在 Session 里面. 当需要对应的权限,且发现已经有<code>SIMPLE_AUTHORIZATION_INFO</code>这个属性,则根据属性中是否含有对应字符串的来判定是否有对应权限.</p>
<p>当然 对应权限的获取,也是通过 shiro 配置里面的 captchaFilter 的具体实现类,实现其<code>isAccessAllowed</code>方法来判定.</p>
<h2 id="summary">Summary</h2>
<p>本次主要分享了 Share 如何在 Spring 中整合 Apache Shiro 的过程. 但是整体配置依然是通过 XML 统一配置,其实 Shiro 在近期的版本已经有了 Annotation 级别的方法能够方便的对 URL 的 Mapping 进行注解. 具体的应用过程,就像 Spring 2.X 升级到 3.X 的过程一样,但是由于没有实战,不便多说.</p>
</div><div class="jss169"></div><div class="jss201"><img src="https://views.show/svg?key=apache-shiro-spring-integration&amp;x=0%25&amp;y=10%25" alt="views show"></div><a role="button" class="MuiChip-root jss202 MuiChip-clickable" tabindex="0" href="/tags/spring"><span class="MuiChip-label">Spring</span></a><a role="button" class="MuiChip-root jss202 MuiChip-clickable" tabindex="0" href="/tags/security"><span class="MuiChip-label">Security</span></a><a role="button" class="MuiChip-root jss202 MuiChip-clickable" tabindex="0" href="/tags/shiro"><span class="MuiChip-label">Shiro</span></a><a role="button" class="MuiChip-root jss202 MuiChip-clickable" tabindex="0" href="/tags/java"><span class="MuiChip-label">Java</span></a><div id="disqus_thread"></div></div></div><div class="jss150"><nav class="jss170"><ol class="jss173"><li class="MuiTypography-root jss172 MuiTypography-body1" style="padding-left: 8px;">Contents</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 16px;">Background</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 16px;">权限控制</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 24px;">URL 级别的权限控制</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 32px;">业务场景假设</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 32px;">Shiro 基本配置</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 40px;">Maven</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 40px;">web.xml</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 40px;">Spring ApplicationContext.xml</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 40px;">Spring applicationContext-shiro-captcha.xml</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 32px;">配置详解</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 40px;">登录与注销</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 48px;">登录</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 48px;">注销</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 40px;">同步登录与异步登陆</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 40px;">角色校验</li><li class="MuiTypography-root jss174 MuiTypography-body1" style="padding-left: 16px;">Summary</li></ol></nav></div></div></main><div role="presentation" class="jss11" style="transform: scale(0); visibility: hidden;"><button class="MuiButtonBase-root MuiFab-root MuiFab-sizeSmall MuiFab-primary" tabindex="0" type="button" aria-label="scroll back to top"><span class="MuiFab-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></span><span class="MuiTouchRipple-root"></span></button></div></div></div><script src="/static/js/vendors.b080bef2d65920182a2a.js"></script><script src="/static/js/main.2e4a0776f36cd619f3c7.js"></script></body></html>