<!DOCTYPE html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><!--[if IE]><link rel="icon" href="/favicon.ico" /><![endif]--><title>Latest Update on Blog App | Aquariuslt Blog</title><link href="/css/about.f196d9fa.css" rel="prefetch"><link href="/css/detail.550d548d.css" rel="prefetch"><link href="/js/about.c7f39767.js" rel="prefetch"><link href="/js/detail.0ea8bb28.js" rel="prefetch"><link href="/css/app.2d6b9bb1.css" rel="preload" as="style"><link href="/css/chunk-vendors.9bb7e852.css" rel="preload" as="style"><link href="/js/app.13ac62a3.js" rel="preload" as="script"><link href="/js/chunk-vendors.948d257a.js" rel="preload" as="script"><link href="/css/chunk-vendors.9bb7e852.css" rel="stylesheet"><link href="/css/app.2d6b9bb1.css" rel="stylesheet"><link rel="icon" type="image/png" sizes="32x32" href="/img/icons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/icons/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#1A73E8"><meta name="apple-mobile-web-app-capable" content="no"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="apple-mobile-web-app-title" content="Aquariuslt Blog"><link rel="apple-touch-icon" href="/img/icons/apple-touch-icon-152x152.png"><link rel="mask-icon" href="/img/icons/safari-pinned-tab.svg" color="#1A73E8"><meta name="msapplication-TileImage" content="/img/icons/msapplication-icon-144x144.png"><meta name="msapplication-TileColor" content="#000000"><link rel="stylesheet" type="text/css" href="/css/detail.550d548d.css"><script charset="utf-8" src="/js/detail.0ea8bb28.js"></script><meta data-vue-meta="1" name="og:site_name" content="Aquariuslt Blog"><meta data-vue-meta="1" name="og:type" content="website"><meta data-vue-meta="1" name="og:title" content="Latest Update on Blog App"><meta data-vue-meta="1" name="og:description" content="结合最近学到的一些知识，了解的一些规范，和实践过的一些新姿势，重构了 Blog 的整个应用。目前 Vue Branch 版本从4.0.0-beta 到了4.0.1 ，算是可以标记 release 的一个版本了。项目地址不变。(除了最近更新过一次 Github account 的 url，开头从大写变成小写，对其他第三方服务迁移的时候有点麻烦)。
"><meta data-vue-meta="1" name="og:image" content="./cover.png"><meta data-vue-meta="1" name="og:type" content="article"><script data-vue-meta="1" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://blog.aquariuslt.com","name":"Aquariuslt Blog","position":1},{"@type":"ListItem","item":"https://blog.aquariuslt.com/posts","name":"Posts","position":2},{"@type":"ListItem","item":"https://blog.aquariuslt.com/posts/2018/03/03/latest-update-on-blog-app","name":"Latest Update on Blog App","position":3}]}</script><script id="embed-disqus" data-timestamp="1571677508264" type="text/javascript" async="" src="//aquariuslt.disqus.com/embed.js"></script><link rel="prefetch" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.953a2bd009935f47a8e815c3ee2bfc5a.css"><link rel="prefetch" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.bdf2715fe3d262793670748c6697b1f3.js"><link rel="prefetch" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.df4113f81691d4ed6cccc5b74c6c17e8.js"><link rel="prefetch" as="script" href="https://disqus.com/next/config.js"><script src="https://c.disquscdn.com/next/embed/alfalfalfa.0823c767a3bc925f628afd9bed26c958.js" async="" charset="UTF-8"></script></head><body><div data-v-18dadf06="" id="app"><div data-v-18dadf06="" class="md-app md-app-side-drawer md-layout-row md-waterfall md-fixed md-theme-default"><div data-v-18dadf06="" class="md-drawer md-app-drawer md-theme-default md-left md-temporary"><div data-v-ac1b82fe="" data-v-18dadf06="" class="profile"><div data-v-ac1b82fe="" class="md-card md-theme-default"><div data-v-ac1b82fe="" class="md-card-header"><div data-v-ac1b82fe="" class="md-avatar md-theme-default"><img data-v-ac1b82fe="" src="https://img.aquariuslt.com/social/avator.png" alt="Avatar"></div><div data-v-ac1b82fe="" class="md-title">Aquariuslt</div><div data-v-ac1b82fe="" class="md-subhead">superaquariuslt@gmail.com</div></div></div></div><ul data-v-18dadf06="" class="md-list md-theme-default"><li data-v-18dadf06="" to="/" exact="" class="md-list-item"><a data-v-18dadf06="" href="/" class="md-list-item-router md-list-item-container md-button-clean" mdripple="true"><div class="md-list-item-content md-ripple"><i data-v-18dadf06="" class="mdi mdi-24px mdi-home"></i><span data-v-18dadf06="" class="md-list-item-text">Home</span> </div></a></li><li data-v-18dadf06="" to="/categories" exact="" class="md-list-item"><a data-v-18dadf06="" href="/categories" class="md-list-item-router md-list-item-container md-button-clean" mdripple="true"><div class="md-list-item-content md-ripple"><i data-v-18dadf06="" class="mdi mdi-24px mdi-shape"></i><span data-v-18dadf06="" class="md-list-item-text">Categories</span> </div></a></li><li data-v-18dadf06="" to="/tags" exact="" class="md-list-item"><a data-v-18dadf06="" href="/tags" class="md-list-item-router md-list-item-container md-button-clean" mdripple="true"><div class="md-list-item-content md-ripple"><i data-v-18dadf06="" class="mdi mdi-24px mdi-bookmark"></i><span data-v-18dadf06="" class="md-list-item-text">Tags</span> </div></a></li></ul> </div>  <main class="md-app-container md-flex md-layout-column md-theme-default md-scrollbar" style="padding-left: 0px;"><div data-v-18dadf06="" class="md-toolbar md-app-toolbar md-primary md-theme-default md-elevation-2 md-no-elevation" md-elevation="2" style="top: 0px;"><div data-v-18dadf06="" class="md-toolbar-row"><button data-v-18dadf06="" type="button" class="md-button md-icon-button md-theme-default" aria-label="menu"><div class="md-ripple"><div class="md-button-content"><i data-v-18dadf06="" class="mdi mdi-24px mdi-menu"></i></div> </div></button><span data-v-18dadf06="" class="md-title app-title">Latest Update on Blog App | Aquariuslt Blog</span></div></div> <div class="md-app-scroller md-layout-column md-flex md-theme-default md-scrollbar"><div data-v-18dadf06="" class="md-content md-app-content md-flex md-theme-default"><div data-v-590589f6="" data-v-18dadf06="" class="detail md-layout md-gutter md-alignment-top-center"><div data-v-46cb6cfe="" data-v-590589f6="" class="md-layout md-gutter md-alignment-top-center md-layout-item md-size-100"><div data-v-46cb6cfe="" class="breadcrumbs"><span data-v-46cb6cfe=""><a data-v-46cb6cfe="" href="/" class="breadcrumbs-item"> Aquariuslt Blog</a><span data-v-46cb6cfe="">&gt;</span></span><span data-v-46cb6cfe=""><a data-v-46cb6cfe="" href="/posts" class="breadcrumbs-item"> Posts</a><span data-v-46cb6cfe="">&gt;</span></span><span data-v-46cb6cfe=""><a data-v-46cb6cfe="" href="/posts/2018/03/03/latest-update-on-blog-app" class="breadcrumbs-item router-link-exact-active router-link-active"> Latest Update on Blog App</a><!----></span></div></div><div data-v-48e13d92="" data-v-590589f6="" class="md-layout md-gutter md-alignment-top-center md-layout-item md-size-100"><div data-v-48e13d92="" class="md-card article-detail md-theme-default"><div data-v-48e13d92="" class="md-card-media article-cover"><img data-v-48e13d92="" src="/posts/2018/03/03/latest-update-on-blog-app/cover.png" alt="cover"></div><div data-v-48e13d92="" class="md-card-content markdown-body"><h1>Latest Update on Blog App</h1>
<p>结合最近学到的一些知识，了解的一些规范，和实践过的一些新姿势，重构了 Blog 的整个应用。目前 Vue Branch 版本从<code>4.0.0-beta</code> 到了<code>4.0.1</code> ，算是可以标记 release 的一个版本了。</p>
<p><a href="https://github.com/aquariuslt/blog">项目地址</a>不变。(除了最近更新过一次 Github account 的 url，开头从大写变成小写，对其他第三方服务迁移的时候有点麻烦)。</p>
<h2>Refactor Background</h2>
<p>其实是很少符合很多最佳实践</p>
<ul>
<li>测试流程不完整</li>
<li>代码抽象结构不够好</li>
<li>依赖升级不够及时</li>
<li>Markdown 功能化不够完整(其实这次重构花了很多时间都没有做好)</li>
<li>之前 Gulp 的部分功能 发现 Webpack 已经有比较成熟的方案可以实现，需要替换</li>
</ul>
<h2>New Features</h2>
<p>目前添加的新功能：</p>
<ul>
<li>提供了<code>feed.xml</code>，支持 RSS 功能</li>
<li>支持 Github Pages SEO</li>
<li>支持国际化</li>
<li>同时支持<a href="https://travis-ci.org/aquariuslt/blog/">Travis-CI</a>，<a href="https://circleci.com/gh/aquariuslt/blog">Circle-CI</a> 构建和发布</li>
<li>将覆盖率报告展现在<a href="https://coveralls.io/github/aquariuslt/blog">coveralls.io</a>中</li>
</ul>
<h2>Structure/Design/Dependencies Update</h2>
<p>目前代码结构/框架选型/测试流程上的改进包括好几个方面</p>
<h3>Config Design</h3>
<ul>
<li>修改了入口配置文件<code>application.yml</code>的 schema，结构更加扁平</li>
<li>抽离<code>google site verification</code>到配置文件里</li>
</ul>
<h3>Build Flow</h3>
<ul>
<li>将读取<code>*.md</code>文件的工具类，从 Gulp Tasks 中抽取出来，目的是将来该工具类可以单独分离成一个模块。目前该模块功能是根据源代码生成合适的 api-schema 的内容，并且在<code>marked</code>的功能上做了一个 wrapper，实现自定义 header，自定义代码区块高亮，自定义 id 生成样式等功能</li>
<li>添加生成符合 RSS 规范的相关文件的 Gulp Tasks</li>
<li>添加测试相关的 Gulp Tasks</li>
<li>添加生成静态子页面的 Gulp Task</li>
</ul>
<h3>Testing Flow</h3>
<ul>
<li>目前的测试流程，与语言框架无关的部分，主要是使用<code>karma</code> + <code>webpack</code> + <code>mocha</code> + <code>sinon</code> + <code>chai</code> +<code>puppeteer</code>来构建整体的测试流程。</li>
<li>覆盖率报告方面，主要是使用了<code>karma</code>的<code>spec coverage reporter</code>插件 来生成较为通用的<code>lcov.info</code>报告文件，方便与各大开放的覆盖率报告平台集成。</li>
<li>与语言框架相关的部分，根据 beta 版本的<code>@vue/test-utils</code> 的官方推荐单元测试编写方法改写了各大组件的测试前置代码(最新的几个版本坑有点多，大概是与那些在代码里面强行加入了 SSR 的检测之类的改动导致体验挺糟糕的)</li>
<li>使用了<code>moxios</code>这个<code>axios</code>官方的 mockup lib 来做模拟 http 请求方面的测试</li>
</ul>
<h3>Dependencies/3rd Party Lib Selection</h3>
<ul>
<li>PWA 相关配置方面，移除了从利用<code>sw-preache</code>构建出 PWA 相关文件的 Gulp，改而采用<code>offline-plugin</code> + runtime 模式来切分开发环境与生产环境的的加载。</li>
<li>webpack 和相关官方插件升级到 3 的最新版(重构之间 webpack 还发布了 4，但是有点破坏性的改动还没找到合适的替代方案，所以暂时观望和调试中)</li>
<li>添加<code>vue-i18n</code>做国际化</li>
<li>升级 babel 版本到 6 的最新版，重新配置了 babel 相关的配置文件，统一到较合适的阶段</li>
<li><code>vue-material</code>也升级到了 v1.0-beta 版本，为新的 API 修改一轮代码</li>
</ul>
<h2>Benchmark</h2>
<p>目前首次页面加载总共需要 280KB 的流量。 <img src="/posts/2018/03/03/latest-update-on-blog-app/blog-resource-transfer-time.png" alt="blog-resource-transfer-time"></p>
<p><img src="/posts/2018/03/03/latest-update-on-blog-app/benchmark-blog-website.png" alt="benchmark-blog-website"> 重新用 Chrome 的 Audits 工具做了一次测试(中间有根据提示的一些最佳实践准则进行优化) 之后，主要痛点是首次渲染页面时间比较长。</p>
<h2>TODO</h2>
<ul>
<li>重新思考 Markdown 转译工具部分代码的选型(当初选型用 marked 真是真是后悔，完全是照搬 perl 实现)</li>
<li>补全没写的一些单元测试样例</li>
<li>更新<code>vexo-cli</code>提供详细的文档和遵循设计规范的背书说明</li>
</ul>
</div><div data-v-48e13d92="" class="md-card-content"><div data-v-15189bc8="" data-v-48e13d92="" tabindex="0" class="md-chip md-theme-default md-clickable"><div class="md-ripple"><span data-v-15189bc8="" class=""> Vue </span> </div> <!----></div><div data-v-15189bc8="" data-v-48e13d92="" tabindex="0" class="md-chip md-theme-default md-clickable"><div class="md-ripple"><span data-v-15189bc8="" class=""> JavaScript </span> </div> <!----></div><div data-v-15189bc8="" data-v-48e13d92="" tabindex="0" class="md-chip md-theme-default md-clickable"><div class="md-ripple"><span data-v-15189bc8="" class=""> Webpack </span> </div> <!----></div><div data-v-15189bc8="" data-v-48e13d92="" tabindex="0" class="md-chip md-theme-default md-clickable"><div class="md-ripple"><span data-v-15189bc8="" class=""> Karma </span> </div> <!----></div><div data-v-15189bc8="" data-v-48e13d92="" tabindex="0" class="md-chip md-theme-default md-clickable"><div class="md-ripple"><span data-v-15189bc8="" class=""> Gulp </span> </div> <!----></div><div data-v-15189bc8="" data-v-48e13d92="" tabindex="0" class="md-chip md-theme-default md-clickable"><div class="md-ripple"><span data-v-15189bc8="" class=""> Github </span> </div> <!----></div><div data-v-15189bc8="" data-v-48e13d92="" tabindex="0" class="md-chip md-theme-default md-clickable"><div class="md-ripple"><span data-v-15189bc8="" class=""> Blog </span> </div> <!----></div></div><div data-v-48e13d92="" class="md-card-content"><div data-v-7fa946ff="" data-v-48e13d92="" class="comment"><div data-v-7fa946ff="" id="disqus_thread"><iframe id="dsq-app6808" name="dsq-app6808" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="https://disqus.com/embed/comments/?base=default&amp;f=aquariuslt&amp;t_i=-posts-2018-03-03-latest-update-on-blog-app&amp;t_u=https%3A%2F%2Fblog.aquariuslt.com%2Fposts%2F2018%2F03%2F03%2Flatest-update-on-blog-app&amp;t_d=Latest%20Update%20on%20Blog%20App%20%7C%20Aquariuslt%20Blog&amp;t_t=Latest%20Update%20on%20Blog%20App%20%7C%20Aquariuslt%20Blog&amp;s_o=default#version=f274d4b819b5f36115bcd7094ebe0b59" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 374px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div></div></div></div></div></div></div></div></main> <!----></div></div><script src="/service-worker.js"></script><script type="text/javascript" src="/js/chunk-vendors.948d257a.js"></script><script type="text/javascript" src="/js/app.13ac62a3.js"></script><iframe style="display: none;"></iframe></body>